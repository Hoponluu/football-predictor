<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - D·ª± ƒêo√°n T·ªâ S·ªë World Cup 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-green: #4ADE80;
            --yellow-bg: #FEF3C7;
            --stroke: #E0E0E0;
            --stroke-hover: #D6D6D6;
            --bg-gray: #F5F5F5;
            --white: #FFFFFF;
            --black: #000000;
            --text-dark: #1F2937;
            --text-light: #6B7280;
            --red: #EF4444;
            --blue: #3B82F6;
            --orange: #F59E0B;
            --purple: #8B5CF6;
            --border-radius: 12px;
            --spacing: 24px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: var(--bg-gray);
            color: var(--text-dark);
            min-height: 100vh;
        }

        /* Login Screen */
        .login-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-green) 0%, #22C55E 100%);
        }

        .login-card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .login-logo {
            text-align: center;
            margin-bottom: 32px;
        }

        .login-logo-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .login-logo-text {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-dark);
        }

        .login-subtitle {
            text-align: center;
            color: var(--text-light);
            font-size: 14px;
            margin-bottom: 32px;
        }

        /* Admin Layout */
        .admin-layout {
            display: none;
            min-height: 100vh;
        }

        .admin-layout.active {
            display: flex;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: var(--white);
            border-right: 1px solid var(--stroke);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            z-index: 100;
        }

        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid var(--stroke);
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sidebar-logo-icon {
            font-size: 32px;
        }

        .sidebar-logo-text {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-dark);
        }

        .sidebar-nav {
            flex: 1;
            overflow-y: auto;
            padding: 16px 0;
        }

        .nav-section {
            margin-bottom: 24px;
        }

        .nav-section-title {
            padding: 8px 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-light);
            letter-spacing: 0.5px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: var(--text-dark);
            text-decoration: none;
            transition: all 0.2s ease;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }

        .nav-item:hover {
            background: var(--bg-gray);
        }

        .nav-item.active {
            background: rgba(74, 222, 128, 0.1);
            color: var(--primary-green);
            border-right: 3px solid var(--primary-green);
        }

        .nav-item-icon {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }

        .sidebar-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--stroke);
        }

        .admin-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-gray);
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .admin-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-green);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .admin-info {
            flex: 1;
        }

        .admin-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .admin-role {
            font-size: 12px;
            color: var(--text-light);
        }

        .logout-btn {
            width: 100%;
            padding: 10px;
            background: transparent;
            border: 1px solid var(--stroke);
            border-radius: 8px;
            color: var(--red);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.1);
        }

        /* Main Content */
        .main-content {
            margin-left: 260px;
            padding: 24px;
            width: calc(100% - 260px);
        }

        .page-header {
            margin-bottom: 24px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .page-subtitle {
            font-size: 14px;
            color: var(--text-light);
        }

        /* Page Content */
        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 24px;
            border: 1px solid var(--stroke);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-light);
            font-weight: 500;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .stat-change {
            font-size: 12px;
            color: var(--primary-green);
            font-weight: 600;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .stat-icon.green { background: rgba(74, 222, 128, 0.1); }
        .stat-icon.blue { background: rgba(59, 130, 246, 0.1); }
        .stat-icon.orange { background: rgba(245, 158, 11, 0.1); }
        .stat-icon.red { background: rgba(239, 68, 68, 0.1); }
        .stat-icon.purple { background: rgba(139, 92, 246, 0.1); }

        /* Card */
        .card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 24px;
            border: 1px solid var(--stroke);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            margin-bottom: 24px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-dark);
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Montserrat', sans-serif;
        }

        .btn-primary {
            background: var(--primary-green);
            color: var(--white);
        }

        .btn-primary:hover {
            background: #3BC76C;
        }

        .btn-secondary {
            background: var(--white);
            color: var(--text-dark);
            border: 1px solid var(--stroke);
        }

        .btn-secondary:hover {
            background: var(--bg-gray);
        }

        .btn-danger {
            background: var(--red);
            color: var(--white);
        }

        .btn-danger:hover {
            background: #DC2626;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }

        /* Form */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--stroke);
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Montserrat', sans-serif;
            transition: all 0.2s ease;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(74, 222, 128, 0.1);
        }

        .form-input:disabled {
            background: var(--bg-gray);
            cursor: not-allowed;
        }

        /* Table */
        .table-wrapper {
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: var(--bg-gray);
            padding: 12px 16px;
            text-align: left;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--stroke);
        }

        .table td {
            padding: 16px;
            border-bottom: 1px solid var(--stroke);
            font-size: 14px;
        }

        .table tr:hover {
            background: var(--bg-gray);
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge.success {
            background: rgba(74, 222, 128, 0.2);
            color: #15803D;
        }

        .badge.danger {
            background: rgba(239, 68, 68, 0.2);
            color: #991B1B;
        }

        .badge.warning {
            background: rgba(245, 158, 11, 0.2);
            color: #92400E;
        }

        .badge.info {
            background: rgba(59, 130, 246, 0.2);
            color: #1E40AF;
        }

        /* Action Buttons */
        .action-btns {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .action-btn.edit {
            background: rgba(59, 130, 246, 0.1);
            color: var(--blue);
        }

        .action-btn.edit:hover {
            background: rgba(59, 130, 246, 0.2);
        }

        .action-btn.delete {
            background: rgba(239, 68, 68, 0.1);
            color: var(--red);
        }

        .action-btn.delete:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        .action-btn.view {
            background: rgba(245, 158, 11, 0.1);
            color: var(--orange);
        }

        .action-btn.view:hover {
            background: rgba(245, 158, 11, 0.2);
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--white);
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--stroke);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-dark);
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-light);
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: var(--bg-gray);
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--stroke);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* Alert */
        .alert {
            padding: 16px 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .alert.warning {
            background: #FEF3C7;
            border: 1px solid #F59E0B;
            color: #92400E;
        }

        .alert.danger {
            background: #FEE2E2;
            border: 1px solid #EF4444;
            color: #991B1B;
        }

        .alert.info {
            background: #DBEAFE;
            border: 1px solid #3B82F6;
            color: #1E40AF;
        }

        .alert.success {
            background: #D1FAE5;
            border: 1px solid #4ADE80;
            color: #065F46;
        }

        .alert-icon {
            font-size: 20px;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .alert-text {
            font-size: 13px;
            line-height: 1.5;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .empty-text {
            font-size: 14px;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-light);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            margin: 0 auto 16px;
            border: 4px solid var(--bg-gray);
            border-top-color: var(--primary-green);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Team Flag Preview */
        .flag-preview {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            border-radius: 8px;
            font-size: 32px;
            margin-right: 12px;
        }

        /* Rules Editor */
        .rule-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .rule-label {
            flex: 1;
            font-size: 14px;
            font-weight: 500;
        }

        .rule-input {
            width: 80px;
            padding: 8px;
            border: 1px solid var(--stroke);
            border-radius: 6px;
            text-align: center;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.mobile-active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                width: 100%;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-card">
            <div class="login-logo">
                <div class="login-logo-icon">üõ†Ô∏è</div>
                <div class="login-logo-text">Admin Panel</div>
            </div>
            <p class="login-subtitle">D·ª± ƒêo√°n T·ªâ S·ªë World Cup 2026</p>
            
            <form id="loginForm" onsubmit="handleAdminLogin(event)">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="adminEmail" placeholder="admin@example.com" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="adminPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">ƒêƒÉng nh·∫≠p</button>
            </form>
        </div>
    </div>

    <!-- Admin Layout -->
    <div class="admin-layout" id="adminLayout">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <span class="sidebar-logo-icon">‚öΩ</span>
                    <span class="sidebar-logo-text">WC 2026 Admin</span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">T·ªïng quan</div>
                    <a class="nav-item active" onclick="switchAdminPage('dashboard')">
                        <span class="nav-item-icon">üìä</span>
                        <span>Dashboard</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Qu·∫£n l√Ω</div>
                    <a class="nav-item" onclick="switchAdminPage('matches')">
                        <span class="nav-item-icon">‚öΩ</span>
                        <span>Tr·∫≠n ƒë·∫•u</span>
                    </a>
                    <a class="nav-item" onclick="switchAdminPage('players')">
                        <span class="nav-item-icon">üë•</span>
                        <span>Ng∆∞·ªùi ch∆°i</span>
                    </a>
                    <a class="nav-item" onclick="switchAdminPage('groups')">
                        <span class="nav-item-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
                        <span>Nh√≥m</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">C·∫•u h√¨nh</div>
                    <a class="nav-item" onclick="switchAdminPage('rules')">
                        <span class="nav-item-icon">‚öôÔ∏è</span>
                        <span>Lu·∫≠t ch∆°i</span>
                    </a>
                    <a class="nav-item" onclick="switchAdminPage('favorites')">
                        <span class="nav-item-icon">‚≠ê</span>
                        <span>ƒê·ªôi y√™u th√≠ch</span>
                    </a>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="admin-profile">
                    <div class="admin-avatar">üë®‚Äçüíº</div>
                    <div class="admin-info">
                        <div class="admin-name" id="adminName">Admin</div>
                        <div class="admin-role">Qu·∫£n tr·ªã vi√™n</div>
                    </div>
                </div>
                <button class="logout-btn" onclick="handleAdminLogout()">üö™ ƒêƒÉng xu·∫•t</button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page-content active">
                <div class="page-header">
                    <h1 class="page-title">Dashboard</h1>
                    <p class="page-subtitle">T·ªïng quan h·ªá th·ªëng</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-label">T·ªïng s·ªë tr·∫≠n</div>
                                <div class="stat-value" id="totalMatches">0</div>
                                <div class="stat-change" id="matchesChange">ƒêang t·∫£i...</div>
                            </div>
                            <div class="stat-icon green">‚öΩ</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-label">Ng∆∞·ªùi ch∆°i</div>
                                <div class="stat-value" id="totalPlayers">0</div>
                                <div class="stat-change" id="playersChange">ƒêang t·∫£i...</div>
                            </div>
                            <div class="stat-icon blue">üë•</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-label">Nh√≥m</div>
                                <div class="stat-value" id="totalGroups">0</div>
                                <div class="stat-change" id="groupsChange">ƒêang t·∫£i...</div>
                            </div>
                            <div class="stat-icon purple">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-label">D·ª± ƒëo√°n</div>
                                <div class="stat-value" id="totalPredictions">0</div>
                                <div class="stat-change" id="predictionsChange">ƒêang t·∫£i...</div>
                            </div>
                            <div class="stat-icon orange">üéØ</div>
                        </div>
                    </div>
                </div>

                <div id="dashboardAlerts"></div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Tr·∫≠n ƒë·∫•u s·∫Øp t·ªõi</h2>
                        <button class="btn btn-sm btn-primary" onclick="switchAdminPage('matches')">Xem t·∫•t c·∫£</button>
                    </div>
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Tr·∫≠n ƒë·∫•u</th>
                                    <th>Th·ªùi gian</th>
                                    <th>Tr·∫°ng th√°i</th>
                                    <th>D·ª± ƒëo√°n</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="dashboardUpcomingMatches">
                                <tr><td colspan="5" class="loading"><div class="loading-spinner"></div><div>ƒêang t·∫£i...</div></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Matches Management Page -->
            <div id="matches" class="page-content">
                <div class="page-header">
                    <h1 class="page-title">Qu·∫£n l√Ω Tr·∫≠n ƒë·∫•u</h1>
                    <p class="page-subtitle">Th√™m, s·ª≠a, x√≥a v√† nh·∫≠p k·∫øt qu·∫£ tr·∫≠n ƒë·∫•u</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Danh s√°ch tr·∫≠n ƒë·∫•u</h2>
                        <button class="btn btn-primary" onclick="openAddMatchModal()">+ Th√™m tr·∫≠n ƒë·∫•u</button>
                    </div>
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Tr·∫≠n ƒë·∫•u</th>
                                    <th>B·∫£ng</th>
                                    <th>Th·ªùi gian</th>
                                    <th>Tr·∫°ng th√°i</th>
                                    <th>K·∫øt qu·∫£</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="matchesTable">
                                <tr><td colspan="7" class="loading"><div class="loading-spinner"></div><div>ƒêang t·∫£i...</div></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Players Management Page -->
            <div id="players" class="page-content">
                <div class="page-header">
                    <h1 class="page-title">Qu·∫£n l√Ω Ng∆∞·ªùi ch∆°i</h1>
                    <p class="page-subtitle">Xem v√† qu·∫£n l√Ω th√¥ng tin ng∆∞·ªùi ch∆°i</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Danh s√°ch ng∆∞·ªùi ch∆°i</h2>
                        <button class="btn btn-primary" onclick="openAddPlayerModal()">+ Th√™m ng∆∞·ªùi ch∆°i</button>
                    </div>
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>T√™n</th>
                                    <th>Email</th>
                                    <th>Nh√≥m</th>
                                    <th>ƒêi·ªÉm</th>
                                    <th>Tr·∫≠n d·ª± ƒëo√°n</th>
                                    <th>Top 1</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="playersTable">
                                <tr><td colspan="7" class="loading"><div class="loading-spinner"></div><div>ƒêang t·∫£i...</div></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Groups Management Page -->
            <div id="groups" class="page-content">
                <div class="page-header">
                    <h1 class="page-title">Qu·∫£n l√Ω Nh√≥m</h1>
                    <p class="page-subtitle">T·∫°o v√† qu·∫£n l√Ω c√°c nh√≥m thi ƒë·∫•u</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Danh s√°ch nh√≥m</h2>
                        <button class="btn btn-primary" onclick="openAddGroupModal()">+ T·∫°o nh√≥m m·ªõi</button>
                    </div>
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>T√™n nh√≥m</th>
                                    <th>M√£ nh√≥m</th>
                                    <th>S·ªë th√†nh vi√™n</th>
                                    <th>Ng√†y t·∫°o</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="groupsTable">
                                <tr><td colspan="5" class="loading"><div class="loading-spinner"></div><div>ƒêang t·∫£i...</div></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Rules Management Page -->
            <div id="rules" class="page-content">
                <div class="page-header">
                    <h1 class="page-title">Lu·∫≠t ch∆°i & ƒêi·ªÉm s·ªë</h1>
                    <p class="page-subtitle">C·∫•u h√¨nh h·ªá th·ªëng t√≠nh ƒëi·ªÉm</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">ƒêi·ªÉm theo th·ª© h·∫°ng d·ª± ƒëo√°n</h2>
                    </div>
                    <div class="modal-body">
                        <div class="rule-row">
                            <span class="rule-label">ü•á D·ª± ƒëo√°n ch√≠nh x√°c nh·∫•t (Top 1)</span>
                            <input type="number" class="rule-input" id="ruleTop1" value="5">
                            <span>ƒëi·ªÉm</span>
                        </div>
                        <div class="rule-row">
                            <span class="rule-label">ü•à D·ª± ƒëo√°n ch√≠nh x√°c th·ª© 2 (Top 2)</span>
                            <input type="number" class="rule-input" id="ruleTop2" value="4">
                            <span>ƒëi·ªÉm</span>
                        </div>
                        <div class="rule-row">
                            <span class="rule-label">ü•â D·ª± ƒëo√°n ch√≠nh x√°c th·ª© 3 (Top 3)</span>
                            <input type="number" class="rule-input" id="ruleTop3" value="3">
                            <span>ƒëi·ªÉm</span>
                        </div>
                        <div class="rule-row">
                            <span class="rule-label">üèÖ D·ª± ƒëo√°n ch√≠nh x√°c th·ª© 4+</span>
                            <input type="number" class="rule-input" id="ruleOther" value="2">
                            <span>ƒëi·ªÉm</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">ƒêi·ªÉm th∆∞·ªüng ƒë·∫∑c bi·ªát</h2>
                    </div>
                    <div class="modal-body">
                        <div class="rule-row">
                            <span class="rule-label">üéØ ƒêo√°n ƒë√∫ng t·ªâ s·ªë ch√≠nh x√°c</span>
                            <input type="number" class="rule-input" id="ruleExactScore" value="5">
                            <span>ƒëi·ªÉm</span>
                        </div>
                        <div class="rule-row">
                            <span class="rule-label">üí° ƒêo√°n ƒë√∫ng ph√∫t ghi b√†n</span>
                            <input type="number" class="rule-input" id="ruleExactMinute" value="3">
                            <span>ƒëi·ªÉm</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">ƒêi·ªÉm ƒë·ªôi y√™u th√≠ch</h2>
                    </div>
                    <div class="modal-body">
                        <div class="alert info">
                            <span class="alert-icon">‚ÑπÔ∏è</span>
                            <div class="alert-content">
                                <div class="alert-text">Ng∆∞·ªùi ch∆°i ch·ªçn 1 ƒë·ªôi y√™u th√≠ch. ƒê·ªôi ƒë√≥ ƒëi c√†ng s√¢u ‚Üí ƒêi·ªÉm bonus c√†ng cao!</div>
                            </div>
                        </div>
                        <div class="rule-row">
                            <span class="rule-label">V√≤ng b·∫£ng (Group Stage)</span>
                            <input type="number" class="rule-input" id="favGroupStage" value="0">
                            <span>ƒëi·ªÉm</span>
                        </div>
                        <div class="rule-row">
                            <span class="rule-label">V√≤ng 1/16 (Round of 32)</span>
                            <input type="number" class="rule-input" id="favR32" value="5">
                            <span>ƒëi·ªÉm</span>
                        </div>
                        <div class="rule-row">
                            <span class="rule-label">V√≤ng 1/8 (Round of 16)</span>
                            <input type="number" class="rule-input" id="favR16" value="10">
                            <span>ƒëi·ªÉm</span>
                        </div>
                        <div class="rule-row">
                            <span class="rule-label">T·ª© k·∫øt (Quarter Finals)</span>
                            <input type="number" class="rule-input" id="favQuarter" value="20">
                            <span>ƒëi·ªÉm</span>
                        </div>
                        <div class="rule-row">
                            <span class="rule-label">B√°n k·∫øt (Semi Finals)</span>
                            <input type="number" class="rule-input" id="favSemi" value="30">
                            <span>ƒëi·ªÉm</span>
                        </div>
                        <div class="rule-row">
                            <span class="rule-label">Chung k·∫øt (Finals)</span>
                            <input type="number" class="rule-input" id="favFinals" value="40">
                            <span>ƒëi·ªÉm</span>
                        </div>
                        <div class="rule-row">
                            <span class="rule-label">üèÜ V√¥ ƒë·ªãch (Champion)</span>
                            <input type="number" class="rule-input" id="favChampion" value="100">
                            <span>ƒëi·ªÉm</span>
                        </div>
                    </div>
                </div>

                <div style="display: flex; justify-content: flex-end; gap: 12px;">
                    <button class="btn btn-secondary">H·ªßy</button>
                    <button class="btn btn-primary" onclick="saveRules()">üíæ L∆∞u c·∫•u h√¨nh</button>
                </div>
            </div>

            <!-- Favorite Teams Management Page -->
            <div id="favorites" class="page-content">
                <div class="page-header">
                    <h1 class="page-title">ƒê·ªôi y√™u th√≠ch</h1>
                    <p class="page-subtitle">Qu·∫£n l√Ω ƒë·ªôi y√™u th√≠ch v√† deadline</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">‚öôÔ∏è C·∫•u h√¨nh chung</h2>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label class="form-label">Deadline ch·ªçn ƒë·ªôi</label>
                            <input type="datetime-local" class="form-input" id="favoriteDeadline">
                            <small style="color: var(--text-light); display: block; margin-top: 8px;">
                                Sau th·ªùi ƒëi·ªÉm n√†y, ng∆∞·ªùi ch∆°i kh√¥ng th·ªÉ ƒë·ªïi ƒë·ªôi y√™u th√≠ch
                            </small>
                        </div>
                        <button class="btn btn-primary" onclick="saveFavoriteDeadline()">üíæ L∆∞u deadline</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üéØ ƒê·ªôi ƒë∆∞·ª£c ph√©p ch·ªçn (Qualified Teams)</h2>
                    </div>
                    <div class="modal-body">
                        <div class="alert info">
                            <span class="alert-icon">‚ÑπÔ∏è</span>
                            <div class="alert-content">
                                <div class="alert-text">
                                    Ch·ªçn 32-48 ƒë·ªôi ƒë√£ qua v√≤ng b·∫£ng. Ch·ªâ c√°c ƒë·ªôi n√†y m·ªõi hi·ªÉn th·ªã trong danh s√°ch cho ng∆∞·ªùi ch∆°i ch·ªçn.
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 16px;">
                            <button class="btn btn-primary" onclick="openSelectQualifiedTeamsModal()">
                                ‚úÖ Ch·ªçn ƒë·ªôi qualified
                            </button>
                            <span style="margin-left: 12px; color: var(--text-light);" id="qualifiedTeamsCount">
                                0 ƒë·ªôi ƒë√£ ch·ªçn
                            </span>
                        </div>
                        
                        <div id="qualifiedTeamsList" style="display: flex; flex-wrap: wrap; gap: 8px;">
                            <!-- Will be populated -->
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">‚ùå ƒê·ªôi b·ªã lo·∫°i (Eliminated Teams)</h2>
                    </div>
                    <div class="modal-body">
                        <div class="alert warning">
                            <span class="alert-icon">‚ö†Ô∏è</span>
                            <div class="alert-content">
                                <div class="alert-text">
                                    Mark c√°c ƒë·ªôi ƒë√£ b·ªã lo·∫°i ·ªü t·ª´ng v√≤ng ƒë·ªÉ t√≠nh ƒëi·ªÉm cho ng∆∞·ªùi ch·ªçn ƒë·ªôi ƒë√≥.
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: grid; gap: 16px;">
                            <div>
                                <h4 style="margin-bottom: 12px;">V√≤ng 1/32 (Round of 32)</h4>
                                <button class="btn btn-sm btn-secondary" onclick="openMarkEliminatedModal('r32')">
                                    Mark ƒë·ªôi b·ªã lo·∫°i
                                </button>
                                <div id="eliminatedR32" style="margin-top: 8px; color: var(--text-light);">
                                    Ch∆∞a c√≥ ƒë·ªôi b·ªã lo·∫°i
                                </div>
                            </div>
                            
                            <div>
                                <h4 style="margin-bottom: 12px;">V√≤ng 1/16 (Round of 16)</h4>
                                <button class="btn btn-sm btn-secondary" onclick="openMarkEliminatedModal('r16')">
                                    Mark ƒë·ªôi b·ªã lo·∫°i
                                </button>
                                <div id="eliminatedR16" style="margin-top: 8px; color: var(--text-light);">
                                    Ch∆∞a c√≥ ƒë·ªôi b·ªã lo·∫°i
                                </div>
                            </div>
                            
                            <div>
                                <h4 style="margin-bottom: 12px;">T·ª© k·∫øt (Quarter Finals)</h4>
                                <button class="btn btn-sm btn-secondary" onclick="openMarkEliminatedModal('quarter')">
                                    Mark ƒë·ªôi b·ªã lo·∫°i
                                </button>
                                <div id="eliminatedQuarter" style="margin-top: 8px; color: var(--text-light);">
                                    Ch∆∞a c√≥ ƒë·ªôi b·ªã lo·∫°i
                                </div>
                            </div>
                            
                            <div>
                                <h4 style="margin-bottom: 12px;">B√°n k·∫øt (Semi Finals)</h4>
                                <button class="btn btn-sm btn-secondary" onclick="openMarkEliminatedModal('semi')">
                                    Mark ƒë·ªôi b·ªã lo·∫°i
                                </button>
                                <div id="eliminatedSemi" style="margin-top: 8px; color: var(--text-light);">
                                    Ch∆∞a c√≥ ƒë·ªôi b·ªã lo·∫°i
                                </div>
                            </div>
                            
                            <div>
                                <h4 style="margin-bottom: 12px;">Chung k·∫øt (Finals)</h4>
                                <button class="btn btn-sm btn-secondary" onclick="openMarkEliminatedModal('finals')">
                                    Mark ƒë·ªôi b·ªã lo·∫°i (√Å qu√¢n)
                                </button>
                                <div id="eliminatedFinals" style="margin-top: 8px; color: var(--text-light);">
                                    Ch∆∞a c√≥ ƒë·ªôi b·ªã lo·∫°i
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üìã ƒê·ªôi y√™u th√≠ch c·ªßa ng∆∞·ªùi ch∆°i</h2>
                    </div>
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Ng∆∞·ªùi ch∆°i</th>
                                    <th>Nh√≥m</th>
                                    <th>ƒê·ªôi y√™u th√≠ch</th>
                                    <th>Th·ªùi gian ch·ªçn</th>
                                    <th>ƒêi·ªÉm hi·ªán t·∫°i</th>
                                </tr>
                            </thead>
                            <tbody id="favoritesTable">
                                <tr><td colspan="5" class="loading"><div class="loading-spinner"></div><div>ƒêang t·∫£i...</div></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals will be added via JavaScript as this file is getting large -->
    <div id="modalsContainer"></div>

    <!-- Add Match Modal -->
    <div class="modal-overlay" id="addMatchModal">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title" id="addMatchModalTitle">Th√™m tr·∫≠n ƒë·∫•u m·ªõi</h3>
                <button class="modal-close" onclick="closeModal('addMatchModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ƒê·ªôi nh√†</label>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <span id="homeTeamFlag" class="flag-preview"></span>
                        <select class="form-select" id="matchHomeTeam" onchange="updateTeamFlag('home')" style="flex: 1;">
                            <option value="">Ch·ªçn ƒë·ªôi nh√†</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">ƒê·ªôi kh√°ch</label>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <span id="awayTeamFlag" class="flag-preview"></span>
                        <select class="form-select" id="matchAwayTeam" onchange="updateTeamFlag('away')" style="flex: 1;">
                            <option value="">Ch·ªçn ƒë·ªôi kh√°ch</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">B·∫£ng ƒë·∫•u</label>
                    <input type="text" class="form-input" id="matchGroup" placeholder="VD: B·∫£ng A, V√≤ng 1/8, T·ª© k·∫øt...">
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label class="form-label">Ng√†y</label>
                        <input type="date" class="form-input" id="matchDate">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Gi·ªù</label>
                        <input type="time" class="form-input" id="matchTime">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Tr·∫°ng th√°i</label>
                    <select class="form-select" id="matchStatus">
                        <option value="not-open">Ch∆∞a m·ªü d·ª± ƒëo√°n</option>
                        <option value="open">ƒêang m·ªü d·ª± ƒëo√°n</option>
                        <option value="finished">ƒê√£ k·∫øt th√∫c</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addMatchModal')">H·ªßy</button>
                <button class="btn btn-primary" onclick="saveMatch()">üíæ L∆∞u</button>
            </div>
        </div>
    </div>

    <!-- Enter Result Modal -->
    <div class="modal-overlay" id="enterResultModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title" id="enterResultModalTitle">Nh·∫≠p k·∫øt qu·∫£ tr·∫≠n ƒë·∫•u</h3>
                <button class="modal-close" onclick="closeModal('enterResultModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 24px;">
                    <h4 id="resultMatchTitle" style="font-size: 18px; font-weight: 600;">Loading...</h4>
                </div>
                
                <!-- Edit Warning -->
                <div id="editResultWarning" class="alert warning" style="display: none; margin-bottom: 16px;">
                    <span class="alert-icon">‚ö†Ô∏è</span>
                    <div class="alert-content">
                        <div class="alert-text">
                            <strong>L∆∞u √Ω:</strong> S·ª≠a k·∫øt qu·∫£ s·∫Ω t√≠nh l·∫°i ƒëi·ªÉm cho t·∫•t c·∫£ d·ª± ƒëo√°n c·ªßa tr·∫≠n n√†y!
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                    <div class="form-group">
                        <label class="form-label">T·ªâ s·ªë ƒë·ªôi nh√†</label>
                        <input type="number" class="form-input" id="resultHomeScore" min="0" placeholder="0">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">T·ªâ s·ªë ƒë·ªôi kh√°ch</label>
                        <input type="number" class="form-input" id="resultAwayScore" min="0" placeholder="0">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ph√∫t ghi b√†n ƒë·∫ßu ti√™n</label>
                    <input type="number" class="form-input" id="resultMinute" min="1" max="120" placeholder="VD: 75">
                    <small style="color: var(--text-light); display: block; margin-top: 8px;">
                        Nh·∫≠p ph√∫t ghi b√†n ƒë·∫ßu ti√™n (1-120)
                    </small>
                </div>
                
                <div class="alert info">
                    <span class="alert-icon">‚ÑπÔ∏è</span>
                    <div class="alert-content">
                        <div class="alert-text">
                            H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông t√≠nh ƒëi·ªÉm cho t·∫•t c·∫£ d·ª± ƒëo√°n c·ªßa tr·∫≠n n√†y
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('enterResultModal')">H·ªßy</button>
                <button class="btn btn-primary" onclick="saveMatchResult()">‚úÖ X√°c nh·∫≠n k·∫øt qu·∫£</button>
            </div>
        </div>
    </div>

    <!-- Add Player Modal -->
    <div class="modal-overlay" id="addPlayerModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title" id="addPlayerModalTitle">Th√™m ng∆∞·ªùi ch∆°i m·ªõi</h3>
                <button class="modal-close" onclick="closeModal('addPlayerModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">T√™n</label>
                    <input type="text" class="form-input" id="playerName" placeholder="VD: Nguy·ªÖn VƒÉn A">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="playerEmail" placeholder="example@email.com">
                </div>
                
                <div class="form-group" id="playerPasswordGroup">
                    <label class="form-label">M·∫≠t kh·∫©u</label>
                    <input type="password" class="form-input" id="playerPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Nh√≥m</label>
                    <select class="form-select" id="playerGroup">
                        <option value="">Ch·ªçn nh√≥m</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addPlayerModal')">H·ªßy</button>
                <button class="btn btn-primary" onclick="savePlayer()">üíæ L∆∞u</button>
            </div>
        </div>
    </div>

    <!-- Player Detail Modal -->
    <div class="modal-overlay" id="playerDetailModal">
        <div class="modal" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">Chi ti·∫øt ng∆∞·ªùi ch∆°i</h3>
                <button class="modal-close" onclick="closeModal('playerDetailModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 24px;">
                    <div>
                        <div class="form-label">T√™n</div>
                        <div style="font-weight: 600;" id="playerDetailName">-</div>
                    </div>
                    <div>
                        <div class="form-label">Email</div>
                        <div id="playerDetailEmail">-</div>
                    </div>
                    <div>
                        <div class="form-label">Nh√≥m</div>
                        <div id="playerDetailGroup">-</div>
                    </div>
                    <div>
                        <div class="form-label">T·ªïng ƒëi·ªÉm</div>
                        <div style="font-weight: 600; color: var(--primary-green);" id="playerDetailPoints">0</div>
                    </div>
                    <div>
                        <div class="form-label">S·ªë d·ª± ƒëo√°n</div>
                        <div id="playerDetailPredictions">0</div>
                    </div>
                    <div>
                        <div class="form-label">Top 1</div>
                        <div id="playerDetailTop1">0</div>
                    </div>
                    <div>
                        <div class="form-label">ƒê√∫ng t·ªâ s·ªë</div>
                        <div id="playerDetailExact">0</div>
                    </div>
                </div>
                
                <h4 style="margin-bottom: 16px; font-size: 16px; font-weight: 600;">L·ªãch s·ª≠ d·ª± ƒëo√°n</h4>
                <div class="table-wrapper">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Tr·∫≠n ƒë·∫•u</th>
                                <th>D·ª± ƒëo√°n</th>
                                <th>K·∫øt qu·∫£</th>
                                <th>Tr·∫°ng th√°i</th>
                                <th>ƒêi·ªÉm</th>
                            </tr>
                        </thead>
                        <tbody id="playerPredictionsTable">
                            <tr><td colspan="5" class="loading">ƒêang t·∫£i...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('playerDetailModal')">ƒê√≥ng</button>
            </div>
        </div>
    </div>

    <!-- Add Group Modal -->
    <div class="modal-overlay" id="addGroupModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title" id="addGroupModalTitle">T·∫°o nh√≥m m·ªõi</h3>
                <button class="modal-close" onclick="closeModal('addGroupModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">T√™n nh√≥m</label>
                    <input type="text" class="form-input" id="groupName" placeholder="VD: Nh√≥m b·∫°n th√¢n">
                </div>
                
                <div class="form-group">
                    <label class="form-label">M√£ nh√≥m</label>
                    <input type="text" class="form-input" id="groupCode" placeholder="WC2026-XXXXX">
                    <small style="color: var(--text-light); display: block; margin-top: 8px;">
                        M√£ n√†y d√πng ƒë·ªÉ ng∆∞·ªùi ch∆°i tham gia nh√≥m
                    </small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addGroupModal')">H·ªßy</button>
                <button class="btn btn-primary" onclick="saveGroup()">üíæ L∆∞u</button>
            </div>
        </div>
    </div>

    <!-- Group Detail Modal -->
    <div class="modal-overlay" id="groupDetailModal">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title">Chi ti·∫øt nh√≥m</h3>
                <button class="modal-close" onclick="closeModal('groupDetailModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 24px;">
                    <div>
                        <div class="form-label">T√™n nh√≥m</div>
                        <div style="font-weight: 600;" id="groupDetailName">-</div>
                    </div>
                    <div>
                        <div class="form-label">M√£ nh√≥m</div>
                        <div><code id="groupDetailCode">-</code></div>
                    </div>
                    <div>
                        <div class="form-label">S·ªë th√†nh vi√™n</div>
                        <div id="groupDetailMembers">0</div>
                    </div>
                    <div>
                        <div class="form-label">Ng√†y t·∫°o</div>
                        <div id="groupDetailCreated">-</div>
                    </div>
                </div>
                
                <h4 style="margin-bottom: 16px; font-size: 16px; font-weight: 600;">Danh s√°ch th√†nh vi√™n</h4>
                <div class="table-wrapper">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>H·∫°ng</th>
                                <th>T√™n</th>
                                <th>ƒêi·ªÉm</th>
                                <th>D·ª± ƒëo√°n</th>
                            </tr>
                        </thead>
                        <tbody id="groupMembersTable">
                            <tr><td colspan="4" class="loading">ƒêang t·∫£i...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('groupDetailModal')">ƒê√≥ng</button>
            </div>
        </div>
    </div>

    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        // Supabase Configuration
        const SUPABASE_CONFIG = {
            url: 'https://bzgfmvxgfgpzinnstgdm.supabase.co',
            anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ6Z2ZtdnhnZmdwemlubnN0Z2RtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1NjUyOTUsImV4cCI6MjA4NjE0MTI5NX0.in-jeMj88CES1pabN7cqNpIQeTeshCeiTgvauqQbcuM'
        };

        // Initialize Supabase
        var supabase = window.supabase.createClient(
            SUPABASE_CONFIG.url,
            SUPABASE_CONFIG.anonKey
        );

        // Global Variables
        var currentAdmin = null;
        var allMatches = [];
        var allPlayers = [];
        var allGroups = [];
        var allPredictions = [];
        var scoringRules = null;

        console.log('‚úÖ Supabase initialized');
        console.log('üìä Database:', SUPABASE_CONFIG.url);

        // Admin Authentication
        async function handleAdminLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            
            console.log('üîê Admin login attempt:', email);
            
            try {
                // Hardcode admin check for now - In production, use proper auth
                if (email === 'admin@wc2026.com' && password === 'admin123') {
                    currentAdmin = { email, name: 'Admin', role: 'admin' };
                    
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('adminLayout').classList.add('active');
                    document.getElementById('adminName').textContent = 'Admin';
                    
                    console.log('‚úÖ Admin logged in');
                    
                    // Load all data
                    await initAdminPanel();
                } else {
                    alert('Email ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!');
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('L·ªói ƒëƒÉng nh·∫≠p: ' + error.message);
            }
        }

        function handleAdminLogout() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) {
                currentAdmin = null;
                document.getElementById('adminLayout').classList.remove('active');
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('adminEmail').value = '';
                document.getElementById('adminPassword').value = '';
            }
        }

        // Initialize Admin Panel
        async function initAdminPanel() {
            console.log('üöÄ Initializing admin panel...');
            
            try {
                await Promise.all([
                    loadMatches(),
                    loadPlayers(),
                    loadGroups(),
                    loadPredictions(),
                    loadScoringRules()
                ]);
                
                renderDashboard();
                renderMatchesTable();
                renderPlayersTable();
                renderGroupsTable();
                renderFavoritesTable();
                
                // Populate dropdowns
                populateTeamSelectors();
                populateGroupSelectors();
                
                console.log('‚úÖ Admin panel ready!');
            } catch (error) {
                console.error('Init error:', error);
                alert('L·ªói t·∫£i d·ªØ li·ªáu: ' + error.message);
            }
        }

        function populateTeamSelectors() {
            const homeSelect = document.getElementById('matchHomeTeam');
            const awaySelect = document.getElementById('matchAwayTeam');
            
            const teams = Object.keys(countries).sort();
            
            let options = '<option value="">Ch·ªçn ƒë·ªôi</option>';
            teams.forEach(team => {
                options += `<option value="${team}">${countries[team].flag} ${team}</option>`;
            });
            
            homeSelect.innerHTML = options;
            awaySelect.innerHTML = options;
        }

        function populateGroupSelectors() {
            const playerGroupSelect = document.getElementById('playerGroup');
            
            let options = '<option value="">Ch·ªçn nh√≥m</option>';
            allGroups.forEach(group => {
                options += `<option value="${group.id}">${group.name} (${group.code})</option>`;
            });
            
            playerGroupSelect.innerHTML = options;
        }

        // Database Functions
        async function loadMatches() {
            try {
                const { data, error } = await supabase
                    .from('matches')
                    .select('*')
                    .order('match_date', { ascending: true });
                
                if (error) throw error;
                
                allMatches = (data || []).map(m => ({
                    ...m,
                    date: new Date(m.match_date)
                }));
                
                console.log('‚úÖ Loaded', allMatches.length, 'matches');
                return allMatches;
            } catch (error) {
                console.error('Load matches error:', error);
                throw error;
            }
        }

        async function loadPlayers() {
            try {
                const { data, error } = await supabase
                    .from('players')
                    .select(`
                        *,
                        groups (
                            id,
                            name,
                            code
                        )
                    `);
                
                if (error) throw error;
                
                allPlayers = data || [];
                
                console.log('‚úÖ Loaded', allPlayers.length, 'players');
                return allPlayers;
            } catch (error) {
                console.error('Load players error:', error);
                throw error;
            }
        }

        async function loadGroups() {
            try {
                const { data, error } = await supabase
                    .from('groups')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                allGroups = data || [];
                
                console.log('‚úÖ Loaded', allGroups.length, 'groups');
                return allGroups;
            } catch (error) {
                console.error('Load groups error:', error);
                throw error;
            }
        }

        async function loadPredictions() {
            try {
                const { data, error } = await supabase
                    .from('predictions')
                    .select('*');
                
                if (error) throw error;
                
                allPredictions = data || [];
                
                console.log('‚úÖ Loaded', allPredictions.length, 'predictions');
                return allPredictions;
            } catch (error) {
                console.error('Load predictions error:', error);
                throw error;
            }
        }

        async function loadScoringRules() {
            try {
                // Try to load from database
                const { data, error } = await supabase
                    .from('scoring_rules')
                    .select('*')
                    .limit(1)
                    .maybeSingle();
                
                // If table doesn't exist or no data, use defaults
                if (error || !data) {
                    console.warn('‚ö†Ô∏è Scoring rules table not found or empty, using defaults');
                    scoringRules = {
                        points_rank_1: 5,
                        points_rank_2: 4,
                        points_rank_3: 3,
                        points_rank_other: 2,
                        points_exact_score: 5,
                        points_exact_minute: 3,
                        fav_group_stage: 0,
                        fav_r32: 5,
                        fav_r16: 10,
                        fav_quarter: 20,
                        fav_semi: 30,
                        fav_finals: 40,
                        fav_champion: 100,
                        favorite_team_deadline: null,
                        qualified_teams: [],
                        eliminated_teams: {}
                    };
                } else {
                    scoringRules = data;
                }
                
                // Populate rules form
                document.getElementById('ruleTop1').value = scoringRules.points_rank_1 || 5;
                document.getElementById('ruleTop2').value = scoringRules.points_rank_2 || 4;
                document.getElementById('ruleTop3').value = scoringRules.points_rank_3 || 3;
                document.getElementById('ruleOther').value = scoringRules.points_rank_other || 2;
                document.getElementById('ruleExactScore').value = scoringRules.points_exact_score || 5;
                document.getElementById('ruleExactMinute').value = scoringRules.points_exact_minute || 3;
                document.getElementById('favGroupStage').value = scoringRules.fav_group_stage || 0;
                document.getElementById('favR32').value = scoringRules.fav_r32 || 5;
                document.getElementById('favR16').value = scoringRules.fav_r16 || 10;
                document.getElementById('favQuarter').value = scoringRules.fav_quarter || 20;
                document.getElementById('favSemi').value = scoringRules.fav_semi || 30;
                document.getElementById('favFinals').value = scoringRules.fav_finals || 40;
                document.getElementById('favChampion').value = scoringRules.fav_champion || 100;
                
                console.log('‚úÖ Loaded scoring rules');
                return scoringRules;
            } catch (error) {
                console.error('Load scoring rules error:', error);
                // Don't throw, just use defaults
                scoringRules = {
                    points_rank_1: 5,
                    points_rank_2: 4,
                    points_rank_3: 3,
                    points_rank_other: 2,
                    points_exact_score: 5,
                    points_exact_minute: 3,
                    fav_group_stage: 0,
                    fav_r32: 5,
                    fav_r16: 10,
                    fav_quarter: 20,
                    fav_semi: 30,
                    fav_finals: 40,
                    fav_champion: 100
                };
                return scoringRules;
            }
        }

        // Render Functions
        function renderDashboard() {
            // Update stats
            document.getElementById('totalMatches').textContent = allMatches.length;
            document.getElementById('totalPlayers').textContent = allPlayers.length;
            document.getElementById('totalGroups').textContent = allGroups.length;
            document.getElementById('totalPredictions').textContent = allPredictions.length;
            
            const finishedMatches = allMatches.filter(m => m.status === 'finished').length;
            const openMatches = allMatches.filter(m => m.status === 'open').length;
            
            document.getElementById('matchesChange').textContent = `${finishedMatches} ƒë√£ k·∫øt th√∫c`;
            document.getElementById('playersChange').textContent = `${allGroups.length} nh√≥m`;
            document.getElementById('groupsChange').textContent = `${allPlayers.length} th√†nh vi√™n`;
            
            const participationRate = allMatches.length > 0 
                ? Math.round((allPredictions.length / (allMatches.length * allPlayers.length)) * 100)
                : 0;
            document.getElementById('predictionsChange').textContent = `${participationRate}% tham gia`;
            
            // Render upcoming matches
            const upcoming = allMatches.filter(m => m.status !== 'finished').slice(0, 5);
            const tbody = document.getElementById('dashboardUpcomingMatches');
            
            if (upcoming.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="empty-state"><div class="empty-icon">üì≠</div><div class="empty-text">Kh√¥ng c√≥ tr·∫≠n ƒë·∫•u s·∫Øp t·ªõi</div></td></tr>';
                return;
            }
            
            let html = '';
            upcoming.forEach(match => {
                const dateStr = match.date.toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit' });
                const timeStr = match.date.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });
                
                let statusBadge = '';
                if (match.status === 'open') {
                    statusBadge = '<span class="badge success">M·ªü</span>';
                } else {
                    statusBadge = '<span class="badge warning">Ch∆∞a m·ªü</span>';
                }
                
                const matchPredictions = allPredictions.filter(p => p.match_id === match.id).length;
                
                const groupDisplay = match.match_group || match.group_name || 'V√≤ng b·∫£ng';
                
                html += `
                    <tr>
                        <td><strong>${match.home_team} vs ${match.away_team}</strong><br><small>${groupDisplay}</small></td>
                        <td>${dateStr}<br>${timeStr}</td>
                        <td>${statusBadge}</td>
                        <td>${matchPredictions}/${allPlayers.length}</td>
                        <td>
                            <div class="action-btns">
                                <button class="action-btn view" onclick="switchAdminPage('matches')" title="Xem">üëÅÔ∏è</button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
            
            // Render alerts
            const needsResult = allMatches.filter(m => {
                const matchDate = new Date(m.match_date);
                const now = new Date();
                return matchDate < now && m.status !== 'finished';
            });
            
            const alertsDiv = document.getElementById('dashboardAlerts');
            if (needsResult.length > 0) {
                alertsDiv.innerHTML = `
                    <div class="alert warning">
                        <span class="alert-icon">‚ö†Ô∏è</span>
                        <div class="alert-content">
                            <div class="alert-title">C·∫ßn x·ª≠ l√Ω</div>
                            <div class="alert-text">
                                ${needsResult.length} tr·∫≠n ƒë√£ k·∫øt th√∫c ch∆∞a nh·∫≠p k·∫øt qu·∫£
                            </div>
                        </div>
                    </div>
                `;
            } else {
                alertsDiv.innerHTML = '';
            }
        }

        function renderMatchesTable() {
            const tbody = document.getElementById('matchesTable');
            
            if (allMatches.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="empty-state"><div class="empty-icon">üì≠</div><div class="empty-text">Ch∆∞a c√≥ tr·∫≠n ƒë·∫•u n√†o</div></td></tr>';
                return;
            }
            
            let html = '';
            allMatches.forEach(match => {
                const dateStr = match.date.toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit', year: 'numeric' });
                const timeStr = match.date.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });
                
                let statusBadge = '';
                if (match.status === 'finished') {
                    statusBadge = '<span class="badge info">K·∫øt th√∫c</span>';
                } else if (match.status === 'open') {
                    statusBadge = '<span class="badge success">M·ªü</span>';
                } else {
                    statusBadge = '<span class="badge warning">Ch∆∞a m·ªü</span>';
                }
                
                const resultText = match.home_score !== null && match.away_score !== null
                    ? `${match.home_score}-${match.away_score} (${match.minute}')`
                    : '-';
                
                // Display match_group (primary) or group_name (fallback)
                const groupDisplay = match.match_group || match.group_name || 'V√≤ng b·∫£ng';
                
                // Use quotes for UUID strings
                const matchIdStr = `'${match.id}'`;
                
                html += `
                    <tr>
                        <td>${match.id}</td>
                        <td><strong>${match.home_team} vs ${match.away_team}</strong></td>
                        <td>${groupDisplay}</td>
                        <td>${dateStr} ${timeStr}</td>
                        <td>${statusBadge}</td>
                        <td>${resultText}</td>
                        <td>
                            <div class="action-btns">
                                ${match.status !== 'finished' ? `<button class="action-btn edit" onclick="editMatch(${matchIdStr})" title="S·ª≠a">‚úèÔ∏è</button>` : ''}
                                ${match.status === 'open' || (match.status !== 'finished' && new Date(match.match_date) < new Date()) ? `<button class="action-btn view" onclick="openEnterResultModal(${matchIdStr})" title="Nh·∫≠p KQ">‚úì</button>` : ''}
                                ${match.status === 'finished' ? `<button class="action-btn edit" onclick="openEditResultModal(${matchIdStr})" title="S·ª≠a KQ">‚úèÔ∏è</button>` : ''}
                                ${match.status === 'finished' ? `<button class="action-btn view" onclick="viewMatchDetails(${matchIdStr})" title="Chi ti·∫øt">üëÅÔ∏è</button>` : ''}
                                <button class="action-btn delete" onclick="deleteMatch(${matchIdStr})" title="X√≥a">üóëÔ∏è</button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        function renderPlayersTable() {
            const tbody = document.getElementById('playersTable');
            
            if (allPlayers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="empty-state"><div class="empty-icon">üì≠</div><div class="empty-text">Ch∆∞a c√≥ ng∆∞·ªùi ch∆°i n√†o</div></td></tr>';
                return;
            }
            
            let html = '';
            allPlayers.forEach(player => {
                const groupName = player.groups?.name || 'N/A';
                const playerPredictions = allPredictions.filter(p => p.player_id === player.id).length;
                
                // Use quotes for UUID strings
                const playerIdStr = `'${player.id}'`;
                
                html += `
                    <tr>
                        <td><strong>${player.name}</strong></td>
                        <td>${player.email}</td>
                        <td>${groupName}</td>
                        <td><strong>${player.total_points || 0}</strong></td>
                        <td>${playerPredictions}</td>
                        <td>${player.top1_count || 0}</td>
                        <td>
                            <div class="action-btns">
                                <button class="action-btn view" onclick="viewPlayerDetails(${playerIdStr})" title="Xem">üëÅÔ∏è</button>
                                <button class="action-btn edit" onclick="editPlayer(${playerIdStr})" title="S·ª≠a">‚úèÔ∏è</button>
                                <button class="action-btn delete" onclick="deletePlayer(${playerIdStr})" title="X√≥a">üóëÔ∏è</button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        function renderGroupsTable() {
            const tbody = document.getElementById('groupsTable');
            
            if (allGroups.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="empty-state"><div class="empty-icon">üì≠</div><div class="empty-text">Ch∆∞a c√≥ nh√≥m n√†o</div></td></tr>';
                return;
            }
            
            let html = '';
            allGroups.forEach(group => {
                const memberCount = allPlayers.filter(p => p.group_id === group.id).length;
                const createdDate = new Date(group.created_at).toLocaleDateString('vi-VN');
                
                // Use quotes for UUID strings
                const groupIdStr = `'${group.id}'`;
                
                html += `
                    <tr>
                        <td><strong>${group.name}</strong></td>
                        <td><code>${group.code}</code></td>
                        <td>${memberCount} ng∆∞·ªùi</td>
                        <td>${createdDate}</td>
                        <td>
                            <div class="action-btns">
                                <button class="action-btn view" onclick="viewGroupDetails(${groupIdStr})" title="Xem">üëÅÔ∏è</button>
                                <button class="action-btn edit" onclick="editGroup(${groupIdStr})" title="S·ª≠a">‚úèÔ∏è</button>
                                <button class="action-btn delete" onclick="deleteGroup(${groupIdStr})" title="X√≥a">üóëÔ∏è</button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        function renderFavoritesTable() {
            const tbody = document.getElementById('favoritesTable');
            
            const playersWithFav = allPlayers.filter(p => p.favorite_team);
            
            if (playersWithFav.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="empty-state"><div class="empty-icon">‚≠ê</div><div class="empty-text">Ch∆∞a c√≥ ai ch·ªçn ƒë·ªôi y√™u th√≠ch</div></td></tr>';
            } else {
                let html = '';
                playersWithFav.forEach(player => {
                    const groupName = player.groups?.name || 'N/A';
                    const selectedDate = player.favorite_selected_at 
                        ? new Date(player.favorite_selected_at).toLocaleString('vi-VN')
                        : 'N/A';
                    
                    html += `
                        <tr>
                            <td><strong>${player.name}</strong></td>
                            <td>${groupName}</td>
                            <td>${player.favorite_team}</td>
                            <td>${selectedDate}</td>
                            <td>${player.favorite_points || 0} ƒëi·ªÉm</td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
            }
            
            // Also render qualified and eliminated teams lists
            renderQualifiedTeamsList();
            renderEliminatedTeamsList();
        }

        // Page Navigation
        function switchAdminPage(pageId) {
            // Remove active class from all pages and nav items
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to selected page and nav item
            document.getElementById(pageId).classList.add('active');
            document.querySelector(`[onclick="switchAdminPage('${pageId}')"]`)?.classList.add('active');
        }

        // Modal Functions (Simplified - Full implementation continues...)
        function openAddMatchModal() {
            alert('Ch·ª©c nƒÉng th√™m tr·∫≠n ƒë·∫•u - ƒêang ph√°t tri·ªÉn...');
        }

        function editMatch(id) {
            alert('Ch·ª©c nƒÉng s·ª≠a tr·∫≠n ƒë·∫•u ID: ' + id + ' - ƒêang ph√°t tri·ªÉn...');
        }

        function deleteMatch(id) {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a tr·∫≠n ƒë·∫•u n√†y?')) {
                alert('Delete match ID: ' + id);
            }
        }

        function openEnterResultModal(id) {
            alert('Ch·ª©c nƒÉng nh·∫≠p k·∫øt qu·∫£ match ID: ' + id + ' - ƒêang ph√°t tri·ªÉn...');
        }

        function viewMatchDetails(id) {
            alert('Xem chi ti·∫øt match ID: ' + id);
        }

        function openAddPlayerModal() {
            alert('Ch·ª©c nƒÉng th√™m ng∆∞·ªùi ch∆°i - ƒêang ph√°t tri·ªÉn...');
        }

        function editPlayer(id) {
            alert('Ch·ª©c nƒÉng s·ª≠a ng∆∞·ªùi ch∆°i ID: ' + id);
        }

        function deletePlayer(id) {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ng∆∞·ªùi ch∆°i n√†y?')) {
                alert('Delete player ID: ' + id);
            }
        }

        function viewPlayerDetails(id) {
            alert('Xem chi ti·∫øt player ID: ' + id);
        }

        function openAddGroupModal() {
            alert('Ch·ª©c nƒÉng t·∫°o nh√≥m m·ªõi - ƒêang ph√°t tri·ªÉn...');
        }

        function editGroup(id) {
            alert('Ch·ª©c nƒÉng s·ª≠a nh√≥m ID: ' + id);
        }

        function deleteGroup(id) {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a nh√≥m n√†y?')) {
                alert('Delete group ID: ' + id);
            }
        }

        function viewGroupDetails(id) {
            alert('Xem chi ti·∫øt group ID: ' + id);
        }

        async function saveRules() {
            const rules = {
                id: scoringRules?.id || 1,  // CRITICAL: Include ID for upsert to UPDATE instead of INSERT!
                points_rank_1: parseInt(document.getElementById('ruleTop1').value),
                points_rank_2: parseInt(document.getElementById('ruleTop2').value),
                points_rank_3: parseInt(document.getElementById('ruleTop3').value),
                points_rank_other: parseInt(document.getElementById('ruleOther').value),
                points_exact_score: parseInt(document.getElementById('ruleExactScore').value),
                points_exact_minute: parseInt(document.getElementById('ruleExactMinute').value),
                fav_group_stage: parseInt(document.getElementById('favGroupStage').value),
                fav_r32: parseInt(document.getElementById('favR32').value),
                fav_r16: parseInt(document.getElementById('favR16').value),
                fav_quarter: parseInt(document.getElementById('favQuarter').value),
                fav_semi: parseInt(document.getElementById('favSemi').value),
                fav_finals: parseInt(document.getElementById('favFinals').value),
                fav_champion: parseInt(document.getElementById('favChampion').value)
            };
            
            try {
                const { data, error } = await supabase
                    .from('scoring_rules')
                    .upsert(rules, { onConflict: 'id' })  // Specify conflict column
                    .select()
                    .single();
                
                if (error) throw error;
                
                scoringRules = data;
                alert('‚úÖ ƒê√£ l∆∞u c·∫•u h√¨nh lu·∫≠t ch∆°i!');
            } catch (error) {
                console.error('Save rules error:', error);
                alert('L·ªói l∆∞u c·∫•u h√¨nh: ' + error.message);
            }
        }

        async function saveFavoriteDeadline() {
            const deadline = document.getElementById('favoriteDeadline').value;
            
            if (!deadline) {
                alert('Vui l√≤ng ch·ªçn th·ªùi gian deadline!');
                return;
            }
            
            try {
                const { error } = await supabase
                    .from('scoring_rules')
                    .update({ favorite_team_deadline: deadline })
                    .eq('id', scoringRules?.id || 1);
                
                if (error) throw error;
                
                alert('‚úÖ ƒê√£ l∆∞u deadline!');
                await loadScoringRules();
            } catch (error) {
                console.error('Save deadline error:', error);
                alert('L·ªói l∆∞u deadline: ' + error.message);
            }
        }

        // Qualified Teams Management
        function openSelectQualifiedTeamsModal() {
            // Create modal dynamically
            const modalHTML = `
                <div class="modal-overlay active" id="qualifiedTeamsModal">
                    <div class="modal" style="max-width: 800px;">
                        <div class="modal-header">
                            <h3 class="modal-title">Ch·ªçn ƒë·ªôi qualified (qua v√≤ng b·∫£ng)</h3>
                            <button class="modal-close" onclick="closeQualifiedTeamsModal()">√ó</button>
                        </div>
                        <div class="modal-body">
                            <div style="margin-bottom: 16px;">
                                <input type="text" class="form-input" id="searchQualifiedTeams" placeholder="T√¨m ki·∫øm ƒë·ªôi..." onkeyup="filterQualifiedTeams()">
                            </div>
                            <div id="qualifiedTeamsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px; max-height: 400px; overflow-y: auto;">
                                <!-- Will be populated -->
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeQualifiedTeamsModal()">H·ªßy</button>
                            <button class="btn btn-primary" onclick="saveQualifiedTeams()">üíæ L∆∞u</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHTML;
            
            // Populate with all countries
            const allTeams = Object.keys(countries).sort();
            const selectedTeams = scoringRules?.qualified_teams || [];
            
            const grid = document.getElementById('qualifiedTeamsGrid');
            let html = '';
            
            allTeams.forEach(team => {
                const isSelected = selectedTeams.includes(team);
                html += `
                    <div class="team-checkbox-item" style="padding: 8px; border: 1px solid var(--stroke); border-radius: 8px; cursor: pointer; background: ${isSelected ? 'rgba(74, 222, 128, 0.1)' : 'white'};" onclick="toggleQualifiedTeam('${team}')">
                        <input type="checkbox" id="team-${team}" ${isSelected ? 'checked' : ''} style="margin-right: 8px;">
                        <span style="font-size: 20px;">${countries[team].flag}</span>
                        <span style="margin-left: 8px; font-size: 14px;">${team}</span>
                    </div>
                `;
            });
            
            grid.innerHTML = html;
        }

        function toggleQualifiedTeam(team) {
            const checkbox = document.getElementById(`team-${team}`);
            checkbox.checked = !checkbox.checked;
            
            // Update visual
            const item = checkbox.parentElement;
            item.style.background = checkbox.checked ? 'rgba(74, 222, 128, 0.1)' : 'white';
        }

        function filterQualifiedTeams() {
            const search = document.getElementById('searchQualifiedTeams').value.toLowerCase();
            const items = document.querySelectorAll('.team-checkbox-item');
            
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(search) ? 'block' : 'none';
            });
        }

        async function saveQualifiedTeams() {
            const checkboxes = document.querySelectorAll('.team-checkbox-item input[type="checkbox"]');
            const selected = [];
            
            checkboxes.forEach(cb => {
                if (cb.checked) {
                    const team = cb.id.replace('team-', '');
                    selected.push(team);
                }
            });
            
            try {
                const { error } = await supabase
                    .from('scoring_rules')
                    .update({ qualified_teams: selected })
                    .eq('id', scoringRules?.id || 1);
                
                if (error) throw error;
                
                scoringRules.qualified_teams = selected;
                renderQualifiedTeamsList();
                closeQualifiedTeamsModal();
                alert(`‚úÖ ƒê√£ l∆∞u ${selected.length} ƒë·ªôi!`);
            } catch (error) {
                console.error('Save qualified teams error:', error);
                alert('L·ªói: ' + error.message);
            }
        }

        function closeQualifiedTeamsModal() {
            document.getElementById('modalsContainer').innerHTML = '';
        }

        function renderQualifiedTeamsList() {
            const list = document.getElementById('qualifiedTeamsList');
            const count = document.getElementById('qualifiedTeamsCount');
            const teams = scoringRules?.qualified_teams || [];
            
            count.textContent = `${teams.length} ƒë·ªôi ƒë√£ ch·ªçn`;
            
            if (teams.length === 0) {
                list.innerHTML = '<span style="color: var(--text-light);">Ch∆∞a c√≥ ƒë·ªôi n√†o</span>';
                return;
            }
            
            let html = '';
            teams.forEach(team => {
                html += `
                    <div style="padding: 6px 12px; background: var(--bg-gray); border-radius: 6px; display: inline-flex; align-items: center; gap: 8px;">
                        <span style="font-size: 16px;">${countries[team]?.flag || 'üè¥'}</span>
                        <span style="font-size: 13px;">${team}</span>
                    </div>
                `;
            });
            
            list.innerHTML = html;
        }

        // Eliminated Teams Management
        function openMarkEliminatedModal(round) {
            const roundNames = {
                'r32': 'V√≤ng 1/32',
                'r16': 'V√≤ng 1/16',
                'quarter': 'T·ª© k·∫øt',
                'semi': 'B√°n k·∫øt',
                'finals': 'Chung k·∫øt (√Å qu√¢n)'
            };
            
            const modalHTML = `
                <div class="modal-overlay active" id="eliminatedTeamsModal">
                    <div class="modal" style="max-width: 600px;">
                        <div class="modal-header">
                            <h3 class="modal-title">Mark ƒë·ªôi b·ªã lo·∫°i - ${roundNames[round]}</h3>
                            <button class="modal-close" onclick="closeEliminatedModal()">√ó</button>
                        </div>
                        <div class="modal-body">
                            <div style="margin-bottom: 16px;">
                                <input type="text" class="form-input" id="searchEliminatedTeams" placeholder="T√¨m ki·∫øm ƒë·ªôi..." onkeyup="filterEliminatedTeams()">
                            </div>
                            <div id="eliminatedTeamsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px; max-height: 400px; overflow-y: auto;">
                                <!-- Will be populated -->
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeEliminatedModal()">H·ªßy</button>
                            <button class="btn btn-primary" onclick="saveEliminatedTeams('${round}')">üíæ L∆∞u</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('modalsContainer').innerHTML = modalHTML;
            
            // Populate with qualified teams only
            const qualifiedTeams = scoringRules?.qualified_teams || [];
            const eliminated = scoringRules?.eliminated_teams || {};
            const selectedForRound = eliminated[round] || [];
            
            // CRITICAL FIX: Get all teams eliminated in PREVIOUS rounds
            const roundOrder = ['r32', 'r16', 'quarter', 'semi', 'finals'];
            const currentRoundIndex = roundOrder.indexOf(round);
            const previouslyEliminated = new Set();
            
            // Collect teams eliminated in all previous rounds
            for (let i = 0; i < currentRoundIndex; i++) {
                const prevRound = roundOrder[i];
                const teamsInRound = eliminated[prevRound] || [];
                teamsInRound.forEach(team => previouslyEliminated.add(team));
            }
            
            const grid = document.getElementById('eliminatedTeamsGrid');
            let html = '';
            
            qualifiedTeams.forEach(team => {
                const wasEliminatedBefore = previouslyEliminated.has(team);
                const isSelectedThisRound = selectedForRound.includes(team);
                
                // If team was eliminated in previous round, show as disabled/eliminated
                if (wasEliminatedBefore) {
                    html += `
                        <div class="team-checkbox-item" style="padding: 8px; border: 1px solid #ddd; border-radius: 8px; background: #f5f5f5; opacity: 0.5; cursor: not-allowed;" title="ƒê√£ b·ªã lo·∫°i ·ªü v√≤ng tr∆∞·ªõc">
                            <input type="checkbox" disabled style="margin-right: 8px;">
                            <span style="font-size: 18px; filter: grayscale(100%);">${countries[team]?.flag || 'üè¥'}</span>
                            <span style="margin-left: 8px; font-size: 13px; text-decoration: line-through;">${team}</span>
                            <span style="margin-left: 8px; font-size: 11px; color: #999;">‚ùå ƒê√£ lo·∫°i</span>
                        </div>
                    `;
                } else {
                    // Team is still active, can be selected
                    html += `
                        <div class="team-checkbox-item" style="padding: 8px; border: 1px solid var(--stroke); border-radius: 8px; cursor: pointer; background: ${isSelectedThisRound ? 'rgba(239, 68, 68, 0.1)' : 'white'};" onclick="toggleEliminatedTeam('${team}')">
                            <input type="checkbox" id="elim-${team}" ${isSelectedThisRound ? 'checked' : ''} style="margin-right: 8px;">
                            <span style="font-size: 18px;">${countries[team]?.flag || 'üè¥'}</span>
                            <span style="margin-left: 8px; font-size: 13px;">${team}</span>
                        </div>
                    `;
                }
            });
            
            if (qualifiedTeams.length === 0) {
                grid.innerHTML = '<p style="text-align: center; color: var(--text-light); padding: 20px;">Ch∆∞a c√≥ ƒë·ªôi qualified. Vui l√≤ng ch·ªçn ƒë·ªôi qualified tr∆∞·ªõc.</p>';
            } else {
                grid.innerHTML = html;
            }
        }

        function toggleEliminatedTeam(team) {
            const checkbox = document.getElementById(`elim-${team}`);
            checkbox.checked = !checkbox.checked;
            
            const item = checkbox.parentElement;
            item.style.background = checkbox.checked ? 'rgba(239, 68, 68, 0.1)' : 'white';
        }

        function filterEliminatedTeams() {
            const search = document.getElementById('searchEliminatedTeams').value.toLowerCase();
            const items = document.querySelectorAll('.team-checkbox-item');
            
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(search) ? 'block' : 'none';
            });
        }

        async function saveEliminatedTeams(round) {
            const checkboxes = document.querySelectorAll('.team-checkbox-item input[type="checkbox"]');
            const selected = [];
            
            checkboxes.forEach(cb => {
                if (cb.checked) {
                    const team = cb.id.replace('elim-', '');
                    selected.push(team);
                }
            });
            
            try {
                const eliminated = scoringRules?.eliminated_teams || {};
                eliminated[round] = selected;
                
                const { error } = await supabase
                    .from('scoring_rules')
                    .update({ eliminated_teams: eliminated })
                    .eq('id', scoringRules?.id || 1);
                
                if (error) throw error;
                
                scoringRules.eliminated_teams = eliminated;
                renderEliminatedTeamsList();
                closeEliminatedModal();
                alert(`‚úÖ ƒê√£ l∆∞u ${selected.length} ƒë·ªôi b·ªã lo·∫°i!`);
            } catch (error) {
                console.error('Save eliminated teams error:', error);
                alert('L·ªói: ' + error.message);
            }
        }

        function closeEliminatedModal() {
            document.getElementById('modalsContainer').innerHTML = '';
        }

        function renderEliminatedTeamsList() {
            const eliminated = scoringRules?.eliminated_teams || {};
            
            const rounds = {
                'r32': 'eliminatedR32',
                'r16': 'eliminatedR16',
                'quarter': 'eliminatedQuarter',
                'semi': 'eliminatedSemi',
                'finals': 'eliminatedFinals'
            };
            
            Object.entries(rounds).forEach(([round, elemId]) => {
                const div = document.getElementById(elemId);
                if (!div) return;
                
                const teams = eliminated[round] || [];
                
                if (teams.length === 0) {
                    div.textContent = 'Ch∆∞a c√≥ ƒë·ªôi b·ªã lo·∫°i';
                    div.style.color = 'var(--text-light)';
                } else {
                    let html = '';
                    teams.forEach(team => {
                        html += `<span style="margin-right: 8px;">${countries[team]?.flag || 'üè¥'} ${team}</span>`;
                    });
                    div.innerHTML = html;
                    div.style.color = 'var(--text-dark)';
                }
            });
        }

        // Add countries database
        const countries = {
            'Argentina': { flag: 'üá¶üá∑', color: '#74ACDF' },
            'Australia': { flag: 'üá¶üá∫', color: '#012169' },
            'Belgium': { flag: 'üáßüá™', color: '#FDDA24' },
            'Brasil': { flag: 'üáßüá∑', color: '#009B3A' },
            'Canada': { flag: 'üá®üá¶', color: '#FF0000' },
            'Croatia': { flag: 'üá≠üá∑', color: '#FF0000' },
            'England': { flag: 'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø', color: '#FFFFFF' },
            'France': { flag: 'üá´üá∑', color: '#0055A4' },
            'Germany': { flag: 'üá©üá™', color: '#000000' },
            'Italy': { flag: 'üáÆüáπ', color: '#009246' },
            'Japan': { flag: 'üáØüáµ', color: '#BC002D' },
            'Mexico': { flag: 'üá≤üáΩ', color: '#006847' },
            'Netherlands': { flag: 'üá≥üá±', color: '#FF4F00' },
            'Portugal': { flag: 'üáµüáπ', color: '#FF0000' },
            'Spain': { flag: 'üá™üá∏', color: '#AA151B' },
            'United States': { flag: 'üá∫üá∏', color: '#B22234' },
            'Uruguay': { flag: 'üá∫üáæ', color: '#0038A8' },
            'Vietnam': { flag: 'üáªüá≥', color: '#DA251D' },
            'South Korea': { flag: 'üá∞üá∑', color: '#003478' },
            'Morocco': { flag: 'üá≤üá¶', color: '#C1272D' },
            'Senegal': { flag: 'üá∏üá≥', color: '#00853F' },
            'Poland': { flag: 'üáµüá±', color: '#DC143C' },
            'Denmark': { flag: 'üá©üá∞', color: '#C60C30' },
            'Switzerland': { flag: 'üá®üá≠', color: '#FF0000' },
            'Colombia': { flag: 'üá®üá¥', color: '#FCD116' },
            'Ecuador': { flag: 'üá™üá®', color: '#FFD100' },
            'Iran': { flag: 'üáÆüá∑', color: '#239F40' },
            'Saudi Arabia': { flag: 'üá∏üá¶', color: '#165C2A' },
            'Ghana': { flag: 'üá¨üá≠', color: '#006B3F' },
            'Tunisia': { flag: 'üáπüá≥', color: '#E70013' },
            'Costa Rica': { flag: 'üá®üá∑', color: '#002B7F' },
            'Serbia': { flag: 'üá∑üá∏', color: '#C6363C' },
            'Cameroon': { flag: 'üá®üá≤', color: '#007A5E' },
            'Nigeria': { flag: 'üá≥üá¨', color: '#008751' }
        };

        // ============================================
        // MATCH CRUD FUNCTIONS
        // ============================================

        var currentEditingMatch = null;
        var currentResultMatch = null;

        function openAddMatchModal() {
            currentEditingMatch = null;
            
            // Reset form
            document.getElementById('matchHomeTeam').value = '';
            document.getElementById('matchAwayTeam').value = '';
            document.getElementById('matchGroup').value = '';
            document.getElementById('matchDate').value = '';
            document.getElementById('matchTime').value = '';
            document.getElementById('matchStatus').value = 'not-open';
            
            // Reset flag previews
            document.getElementById('homeTeamFlag').textContent = '';
            document.getElementById('awayTeamFlag').textContent = '';
            
            document.getElementById('addMatchModalTitle').textContent = 'Th√™m tr·∫≠n ƒë·∫•u m·ªõi';
            document.getElementById('addMatchModal').classList.add('active');
        }

        async function editMatch(id) {
            // id is already a string (UUID)
            const match = allMatches.find(m => m.id === id);
            if (!match) {
                alert('Kh√¥ng t√¨m th·∫•y tr·∫≠n ƒë·∫•u!');
                return;
            }
            
            currentEditingMatch = match;
            
            // Populate form
            document.getElementById('matchHomeTeam').value = match.home_team;
            document.getElementById('matchAwayTeam').value = match.away_team;
            // Use match_group (primary column) or fallback to group_name
            document.getElementById('matchGroup').value = match.match_group || match.group_name || '';
            
            // Format datetime for input
            const date = new Date(match.match_date);
            const dateStr = date.toISOString().split('T')[0];
            const timeStr = date.toTimeString().slice(0, 5);
            
            document.getElementById('matchDate').value = dateStr;
            document.getElementById('matchTime').value = timeStr;
            document.getElementById('matchStatus').value = match.status;
            
            // Update flag previews
            updateTeamFlag('home');
            updateTeamFlag('away');
            
            document.getElementById('addMatchModalTitle').textContent = 'S·ª≠a tr·∫≠n ƒë·∫•u';
            document.getElementById('addMatchModal').classList.add('active');
        }

        function updateTeamFlag(type) {
            const selectId = type === 'home' ? 'matchHomeTeam' : 'matchAwayTeam';
            const flagId = type === 'home' ? 'homeTeamFlag' : 'awayTeamFlag';
            
            const team = document.getElementById(selectId).value;
            const flagSpan = document.getElementById(flagId);
            
            if (team && countries[team]) {
                flagSpan.textContent = countries[team].flag;
            } else {
                flagSpan.textContent = '';
            }
        }

        async function saveMatch() {
            const homeTeam = document.getElementById('matchHomeTeam').value;
            const awayTeam = document.getElementById('matchAwayTeam').value;
            const group = document.getElementById('matchGroup').value;
            const date = document.getElementById('matchDate').value;
            const time = document.getElementById('matchTime').value;
            const status = document.getElementById('matchStatus').value;
            
            if (!homeTeam || !awayTeam || !date || !time) {
                alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!');
                return;
            }
            
            if (homeTeam === awayTeam) {
                alert('Hai ƒë·ªôi kh√¥ng ƒë∆∞·ª£c tr√πng nhau!');
                return;
            }
            
            const matchDate = new Date(`${date}T${time}`);
            
            const matchData = {
                home_team: homeTeam,
                away_team: awayTeam,
                match_group: group || '',  // Use match_group (database column)
                group_name: group || '',   // Also set group_name for compatibility
                match_date: matchDate.toISOString(),
                status: status
            };
            
            try {
                if (currentEditingMatch) {
                    // Update existing match
                    const { error } = await supabase
                        .from('matches')
                        .update(matchData)
                        .eq('id', currentEditingMatch.id);
                    
                    if (error) throw error;
                    
                    alert('‚úÖ ƒê√£ c·∫≠p nh·∫≠t tr·∫≠n ƒë·∫•u!');
                } else {
                    // Create new match
                    const { error } = await supabase
                        .from('matches')
                        .insert([matchData]);
                    
                    if (error) throw error;
                    
                    alert('‚úÖ ƒê√£ th√™m tr·∫≠n ƒë·∫•u m·ªõi!');
                }
                
                await loadMatches();
                renderMatchesTable();
                renderDashboard();
                closeModal('addMatchModal');
            } catch (error) {
                console.error('Save match error:', error);
                alert('L·ªói: ' + error.message);
            }
        }

        async function deleteMatch(id) {
            if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a tr·∫≠n ƒë·∫•u n√†y? T·∫•t c·∫£ d·ª± ƒëo√°n cho tr·∫≠n n√†y c≈©ng s·∫Ω b·ªã x√≥a!')) {
                return;
            }
            
            try {
                // Delete all predictions for this match first
                const { error: predError } = await supabase
                    .from('predictions')
                    .delete()
                    .eq('match_id', id);
                
                if (predError) throw predError;
                
                // Delete match
                const { error } = await supabase
                    .from('matches')
                    .delete()
                    .eq('id', id);
                
                if (error) throw error;
                
                alert('‚úÖ ƒê√£ x√≥a tr·∫≠n ƒë·∫•u!');
                await loadMatches();
                await loadPredictions();
                renderMatchesTable();
                renderDashboard();
            } catch (error) {
                console.error('Delete match error:', error);
                alert('L·ªói: ' + error.message);
            }
        }

        // Enter Result Functions
        function openEnterResultModal(matchId) {
            // matchId is already a string (UUID)
            const match = allMatches.find(m => m.id === matchId);
            if (!match) {
                alert('Kh√¥ng t√¨m th·∫•y tr·∫≠n ƒë·∫•u!');
                return;
            }
            
            currentResultMatch = match;
            
            document.getElementById('resultMatchTitle').textContent = `${match.home_team} vs ${match.away_team}`;
            document.getElementById('enterResultModalTitle').textContent = 'Nh·∫≠p k·∫øt qu·∫£ tr·∫≠n ƒë·∫•u';
            document.getElementById('resultHomeScore').value = '';
            document.getElementById('resultAwayScore').value = '';
            document.getElementById('resultMinute').value = '';
            
            // Hide edit warning
            document.getElementById('editResultWarning').style.display = 'none';
            
            document.getElementById('enterResultModal').classList.add('active');
        }

        function openEditResultModal(matchId) {
            // matchId is already a string (UUID)
            const match = allMatches.find(m => m.id === matchId);
            if (!match) {
                alert('Kh√¥ng t√¨m th·∫•y tr·∫≠n ƒë·∫•u!');
                return;
            }
            
            if (match.status !== 'finished') {
                alert('Tr·∫≠n ƒë·∫•u ch∆∞a k·∫øt th√∫c!');
                return;
            }
            
            currentResultMatch = match;
            
            document.getElementById('resultMatchTitle').textContent = `${match.home_team} vs ${match.away_team}`;
            document.getElementById('enterResultModalTitle').textContent = 'S·ª≠a k·∫øt qu·∫£ tr·∫≠n ƒë·∫•u';
            
            // Pre-fill with existing results
            document.getElementById('resultHomeScore').value = match.home_score || '';
            document.getElementById('resultAwayScore').value = match.away_score || '';
            document.getElementById('resultMinute').value = match.minute || '';
            
            // Show edit warning
            document.getElementById('editResultWarning').style.display = 'block';
            
            document.getElementById('enterResultModal').classList.add('active');
        }

        async function saveMatchResult() {
            if (!currentResultMatch) return;
            
            const homeScore = parseInt(document.getElementById('resultHomeScore').value);
            const awayScore = parseInt(document.getElementById('resultAwayScore').value);
            const minute = parseInt(document.getElementById('resultMinute').value);
            
            if (isNaN(homeScore) || isNaN(awayScore) || isNaN(minute)) {
                alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!');
                return;
            }
            
            if (homeScore < 0 || awayScore < 0 || minute < 1 || minute > 120) {
                alert('T·ªâ s·ªë ho·∫∑c ph√∫t ghi b√†n kh√¥ng h·ª£p l·ªá!');
                return;
            }
            
            // Detect if editing existing result
            const isEditing = currentResultMatch.status === 'finished' && 
                             currentResultMatch.home_score !== null;
            
            // Confirmation message
            let confirmMsg = `X√°c nh·∫≠n k·∫øt qu·∫£:\n${currentResultMatch.home_team} ${homeScore} - ${awayScore} ${currentResultMatch.away_team}\nPh√∫t: ${minute}'`;
            
            if (isEditing) {
                const oldResult = `${currentResultMatch.home_score}-${currentResultMatch.away_score} (${currentResultMatch.minute}')`;
                const newResult = `${homeScore}-${awayScore} (${minute}')`;
                confirmMsg = `‚ö†Ô∏è S·ª¨A K·∫æT QU·∫¢\n\nK·∫øt qu·∫£ c≈©: ${oldResult}\nK·∫øt qu·∫£ m·ªõi: ${newResult}\n\n` +
                           `ƒêi·ªÉm c·ªßa t·∫•t c·∫£ ng∆∞·ªùi ch∆°i s·∫Ω ƒë∆∞·ª£c t√≠nh l·∫°i!\n\nB·∫°n c√≥ ch·∫Øc ch·∫Øn?`;
            }
            
            if (!confirm(confirmMsg)) {
                return;
            }
            
            try {
                // STEP 1: Save match using PostgreSQL function (bypasses RLS)
                console.log('üìù Saving match result using function...');
                console.log('Match ID:', currentResultMatch.id);
                console.log('Home Score:', homeScore, typeof homeScore);
                console.log('Away Score:', awayScore, typeof awayScore);
                console.log('Minute:', minute, typeof minute);
                
                const { data: matchData, error: matchError } = await supabase.rpc('admin_update_match_result', {
                    p_match_id: currentResultMatch.id,
                    p_home_score: homeScore,
                    p_away_score: awayScore,
                    p_minute: minute
                });
                
                if (matchError) {
                    console.error('‚ùå Match update error:', matchError);
                    console.error('Error details:', JSON.stringify(matchError, null, 2));
                    
                    // If function doesn't exist, show helpful message
                    if (matchError.message && (matchError.message.includes('function') || matchError.message.includes('does not exist'))) {
                        alert('‚ùå L·ªói: PostgreSQL function ch∆∞a ƒë∆∞·ª£c t·∫°o!\n\n' +
                              'Vui l√≤ng:\n' +
                              '1. M·ªü Supabase SQL Editor\n' +
                              '2. Ch·∫°y file FIX-MATCH-UPDATE.sql\n' +
                              '3. Th·ª≠ l·∫°i');
                    } else {
                        alert('‚ùå L·ªói c·∫≠p nh·∫≠t tr·∫≠n ƒë·∫•u: ' + matchError.message);
                    }
                    throw matchError;
                }
                
                console.log('‚úÖ Match result saved via function!', matchData);
                
                // Refresh UI immediately
                await loadMatches();
                renderMatchesTable();
                renderDashboard();
                
                // Show success message for match save
                const successMsg = isEditing 
                    ? '‚úÖ ƒê√£ c·∫≠p nh·∫≠t k·∫øt qu·∫£ tr·∫≠n ƒë·∫•u!'
                    : '‚úÖ ƒê√£ l∆∞u k·∫øt qu·∫£ tr·∫≠n ƒë·∫•u!';
                alert(successMsg);
                
                closeModal('enterResultModal');
                
                // Don't calculate points for now - just save match
                console.log('‚ÑπÔ∏è Match saved. Skipping points calculation.');
                
            } catch (error) {
                console.error('‚ùå Save match result error:', error);
                console.error('Error name:', error.name);
                console.error('Error message:', error.message);
                console.error('Error code:', error.code);
                console.error('Error details:', error.details);
                console.error('Error hint:', error.hint);
                alert('L·ªói l∆∞u k·∫øt qu·∫£: ' + error.message + '\n\nChi ti·∫øt: ' + (error.details || error.hint || 'N/A'));
                return;
            }
        }

        async function calculateAndUpdatePoints(matchId, actualHome, actualAway, actualMinute) {
            try {
                console.log('üîÑ Calculating points for match:', matchId);
                
                // Get all predictions for this match
                const { data: predictions, error: predError} = await supabase
                    .from('predictions')
                    .select('id, player_id, home_score, away_score, minute')
                    .eq('match_id', matchId);
                
                if (predError) {
                    console.error('Error loading predictions:', predError);
                    throw predError;
                }
                
                if (!predictions || predictions.length === 0) {
                    console.log('‚ÑπÔ∏è No predictions for this match');
                    return;
                }
                
                console.log(`üìä Found ${predictions.length} predictions to score`);
                
                // Get scoring rules
                const rules = scoringRules || {
                    points_rank_1: 5,
                    points_rank_2: 4,
                    points_rank_3: 3,
                    points_rank_other: 2,
                    points_exact_score: 5,
                    points_exact_minute: 3
                };
                
                // Calculate scores for all predictions
                const scoredPredictions = predictions.map(pred => {
                    const homeDiff = Math.abs(pred.home_score - actualHome);
                    const awayDiff = Math.abs(pred.away_score - actualAway);
                    const totalDiff = homeDiff + awayDiff;
                    
                    const exactScore = (pred.home_score === actualHome && pred.away_score === actualAway);
                    const exactMinute = (pred.minute === actualMinute);
                    
                    let accuracy = totalDiff;
                    
                    const predWinner = pred.home_score > pred.away_score ? 'home' : 
                                      (pred.home_score < pred.away_score ? 'away' : 'draw');
                    const actualWinner = actualHome > actualAway ? 'home' :
                                        (actualHome < actualAway ? 'away' : 'draw');
                    
                    if (predWinner === actualWinner) {
                        accuracy -= 0.5;
                    }
                    
                    return {
                        id: pred.id,
                        player_id: pred.player_id,
                        accuracy,
                        exactScore,
                        exactMinute
                    };
                });
                
                // Sort by accuracy
                scoredPredictions.sort((a, b) => a.accuracy - b.accuracy);
                
                // Calculate points and prepare updates
                const updates = [];
                const playerPointsMap = {};
                const playerStatsMap = {};
                
                for (let i = 0; i < scoredPredictions.length; i++) {
                    const pred = scoredPredictions[i];
                    
                    // Rank points
                    let rankPoints = 0;
                    if (i === 0) rankPoints = rules.points_rank_1;
                    else if (i === 1) rankPoints = rules.points_rank_2;
                    else if (i === 2) rankPoints = rules.points_rank_3;
                    else rankPoints = rules.points_rank_other;
                    
                    const exactScorePoints = pred.exactScore ? rules.points_exact_score : 0;
                    const exactMinutePoints = pred.exactMinute ? rules.points_exact_minute : 0;
                    const totalPoints = rankPoints + exactScorePoints + exactMinutePoints;
                    
                    updates.push({
                        id: pred.id,
                        player_id: pred.player_id,
                        points_rank: rankPoints,
                        points_exact_score: exactScorePoints,
                        points_minute: exactMinutePoints,
                        total_points: totalPoints
                    });
                    
                    // Accumulate player stats
                    if (!playerPointsMap[pred.player_id]) {
                        playerPointsMap[pred.player_id] = 0;
                        playerStatsMap[pred.player_id] = { exactScoreCount: 0, top1Count: 0 };
                    }
                    playerPointsMap[pred.player_id] += totalPoints;
                    if (pred.exactScore) playerStatsMap[pred.player_id].exactScoreCount++;
                    if (i === 0) playerStatsMap[pred.player_id].top1Count++;
                    
                    console.log(`  #${i+1} Player ${pred.player_id.substring(0,8)}: ${totalPoints} pts (rank:${rankPoints}, exact:${exactScorePoints}, min:${exactMinutePoints})`);
                }
                
                console.log('üíæ Updating predictions using PostgreSQL function...');
                
                // Update predictions using PostgreSQL function (bypasses RLS!)
                let successCount = 0;
                let failCount = 0;
                
                for (const update of updates) {
                    try {
                        const { error } = await supabase.rpc('admin_update_prediction_points', {
                            p_prediction_id: update.id,
                            p_points_rank: update.points_rank,
                            p_points_exact_score: update.points_exact_score,
                            p_points_minute: update.points_minute,
                            p_total_points: update.total_points
                        });
                        
                        if (error) {
                            console.error(`  ‚ùå Error updating prediction ${update.id}:`, error);
                            failCount++;
                        } else {
                            successCount++;
                        }
                        
                        await new Promise(resolve => setTimeout(resolve, 50));
                        
                    } catch (err) {
                        console.error(`  ‚ùå Failed to update prediction ${update.id}:`, err);
                        failCount++;
                    }
                }
                
                console.log(`  ${successCount} predictions updated, ${failCount} failed`);
                
                console.log('üíæ Updating player totals...');
                
                // Update player stats
                for (const playerId of Object.keys(playerPointsMap)) {
                    try {
                        const { data: player } = await supabase
                            .from('players')
                            .select('total_points, exact_score_count, top1_count')
                            .eq('id', playerId)
                            .single();
                        
                        if (player) {
                            const newTotal = (player.total_points || 0) + playerPointsMap[playerId];
                            const newExactCount = (player.exact_score_count || 0) + playerStatsMap[playerId].exactScoreCount;
                            const newTop1Count = (player.top1_count || 0) + playerStatsMap[playerId].top1Count;
                            
                            await supabase
                                .from('players')
                                .update({
                                    total_points: newTotal,
                                    exact_score_count: newExactCount,
                                    top1_count: newTop1Count
                                })
                                .eq('id', playerId);
                            
                            console.log(`  ‚úÖ Player ${playerId.substring(0,8)}: +${playerPointsMap[playerId]} ‚Üí Total: ${newTotal}`);
                        }
                        
                        await new Promise(resolve => setTimeout(resolve, 50));
                        
                    } catch (err) {
                        console.error(`  ‚ùå Failed to update player ${playerId}:`, err);
                    }
                }
                
                if (failCount > 0) {
                    console.warn(`‚ö†Ô∏è Some predictions failed to update (${failCount}/${updates.length})`);
                    console.warn('Check if PostgreSQL function "admin_update_prediction_points" exists');
                } else {
                    console.log('‚úÖ All points calculated and updated successfully!');
                }
                
            } catch (error) {
                console.error('‚ùå Calculate points error:', error);
                throw error;
            }
        }

        async function updatePlayerStats(playerId) {
            try {
                // Get all predictions for this player
                const { data: predictions, error: predError } = await supabase
                    .from('predictions')
                    .select('*')
                    .eq('player_id', playerId);
                
                if (predError) throw predError;
                
                // Calculate totals
                const totalPoints = predictions.reduce((sum, p) => sum + (p.total_points || 0), 0);
                const exactScoreCount = predictions.filter(p => p.points_exact_score > 0).length;
                const top1Count = predictions.filter(p => p.points_rank === (scoringRules?.points_rank_1 || 5)).length;
                
                // Update player
                const { error: updateError } = await supabase
                    .from('players')
                    .update({
                        total_points: totalPoints,
                        exact_score_count: exactScoreCount,
                        top1_count: top1Count
                    })
                    .eq('id', playerId);
                
                if (updateError) throw updateError;
                
                console.log('‚úÖ Updated stats for player', playerId);
            } catch (error) {
                console.error('Update player stats error:', error);
                throw error;
            }
        }

        function viewMatchDetails(id) {
            // id is already a string (UUID)
            const match = allMatches.find(m => m.id === id);
            if (!match) {
                alert('Kh√¥ng t√¨m th·∫•y tr·∫≠n ƒë·∫•u!');
                return;
            }
            
            alert(`Chi ti·∫øt tr·∫≠n ƒë·∫•u:\n${match.home_team} ${match.home_score} - ${match.away_score} ${match.away_team}\nPh√∫t: ${match.minute}'\nTr·∫°ng th√°i: ${match.status}`);
        }

        // ============================================
        // PLAYER CRUD FUNCTIONS
        // ============================================

        var currentEditingPlayer = null;

        function openAddPlayerModal() {
            currentEditingPlayer = null;
            
            document.getElementById('playerName').value = '';
            document.getElementById('playerEmail').value = '';
            document.getElementById('playerPassword').value = '';
            document.getElementById('playerGroup').value = '';
            
            document.getElementById('addPlayerModalTitle').textContent = 'Th√™m ng∆∞·ªùi ch∆°i m·ªõi';
            document.getElementById('playerPasswordGroup').style.display = 'block';
            document.getElementById('addPlayerModal').classList.add('active');
        }

        async function editPlayer(id) {
            // id is already a string (UUID)
            const player = allPlayers.find(p => p.id === id);
            if (!player) {
                alert('Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi ch∆°i!');
                return;
            }
            
            currentEditingPlayer = player;
            
            document.getElementById('playerName').value = player.name;
            document.getElementById('playerEmail').value = player.email;
            document.getElementById('playerGroup').value = player.group_id || '';
            
            document.getElementById('addPlayerModalTitle').textContent = 'S·ª≠a th√¥ng tin ng∆∞·ªùi ch∆°i';
            document.getElementById('playerPasswordGroup').style.display = 'none';
            document.getElementById('addPlayerModal').classList.add('active');
        }

        async function savePlayer() {
            const name = document.getElementById('playerName').value.trim();
            const email = document.getElementById('playerEmail').value.trim();
            const password = document.getElementById('playerPassword').value;
            const groupId = document.getElementById('playerGroup').value; // Keep as string (UUID)
            
            if (!name || !email) {
                alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!');
                return;
            }
            
            if (!currentEditingPlayer && !password) {
                alert('Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u!');
                return;
            }
            
            if (!groupId) {
                alert('Vui l√≤ng ch·ªçn nh√≥m!');
                return;
            }
            
            const playerData = {
                name: name,
                email: email,
                group_id: groupId  // Pass UUID string directly, don't parse to int
            };
            
            // Only include password for new players
            if (!currentEditingPlayer && password) {
                playerData.password = password;
            }
            
            try {
                if (currentEditingPlayer) {
                    // Update existing player
                    const { error } = await supabase
                        .from('players')
                        .update(playerData)
                        .eq('id', currentEditingPlayer.id);
                    
                    if (error) throw error;
                    
                    alert('‚úÖ ƒê√£ c·∫≠p nh·∫≠t th√¥ng tin ng∆∞·ªùi ch∆°i!');
                } else {
                    // Create new player
                    const { error } = await supabase
                        .from('players')
                        .insert([{
                            ...playerData,
                            total_points: 0,
                            exact_score_count: 0,
                            top1_count: 0
                        }]);
                    
                    if (error) throw error;
                    
                    alert('‚úÖ ƒê√£ th√™m ng∆∞·ªùi ch∆°i m·ªõi!');
                }
                
                await loadPlayers();
                renderPlayersTable();
                renderDashboard();
                closeModal('addPlayerModal');
            } catch (error) {
                console.error('Save player error:', error);
                alert('L·ªói: ' + error.message);
            }
        }

        async function deletePlayer(id) {
            if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ng∆∞·ªùi ch∆°i n√†y? T·∫•t c·∫£ d·ª± ƒëo√°n c·ªßa ng∆∞·ªùi n√†y c≈©ng s·∫Ω b·ªã x√≥a!')) {
                return;
            }
            
            try {
                // Delete all predictions
                const { error: predError } = await supabase
                    .from('predictions')
                    .delete()
                    .eq('player_id', id);
                
                if (predError) throw predError;
                
                // Delete player
                const { error } = await supabase
                    .from('players')
                    .delete()
                    .eq('id', id);
                
                if (error) throw error;
                
                alert('‚úÖ ƒê√£ x√≥a ng∆∞·ªùi ch∆°i!');
                await loadPlayers();
                await loadPredictions();
                renderPlayersTable();
                renderDashboard();
            } catch (error) {
                console.error('Delete player error:', error);
                alert('L·ªói: ' + error.message);
            }
        }

        async function viewPlayerDetails(id) {
            // id is already a string (UUID)
            const player = allPlayers.find(p => p.id === id);
            if (!player) {
                alert('Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi ch∆°i!');
                return;
            }
            
            // Get player predictions
            const { data: predictions, error } = await supabase
                .from('predictions')
                .select(`
                    *,
                    matches (
                        home_team,
                        away_team,
                        home_score,
                        away_score,
                        status
                    )
                `)
                .eq('player_id', id)
                .order('created_at', { ascending: false });
            
            if (error) {
                console.error('Load predictions error:', error);
                alert('L·ªói: ' + error.message);
                return;
            }
            
            // Populate modal
            document.getElementById('playerDetailName').textContent = player.name;
            document.getElementById('playerDetailEmail').textContent = player.email;
            document.getElementById('playerDetailGroup').textContent = player.groups?.name || 'N/A';
            document.getElementById('playerDetailPoints').textContent = player.total_points || 0;
            document.getElementById('playerDetailPredictions').textContent = predictions?.length || 0;
            document.getElementById('playerDetailTop1').textContent = player.top1_count || 0;
            document.getElementById('playerDetailExact').textContent = player.exact_score_count || 0;
            
            // Populate predictions table
            const tbody = document.getElementById('playerPredictionsTable');
            
            if (!predictions || predictions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="empty-state">Ch∆∞a c√≥ d·ª± ƒëo√°n n√†o</td></tr>';
            } else {
                let html = '';
                predictions.forEach(pred => {
                    const match = pred.matches;
                    const statusBadge = match.status === 'finished' 
                        ? `<span class="badge info">K·∫øt th√∫c</span>`
                        : `<span class="badge warning">Ch∆∞a KQ</span>`;
                    
                    const actualResult = match.status === 'finished'
                        ? `${match.home_score}-${match.away_score}`
                        : '-';
                    
                    html += `
                        <tr>
                            <td>${match.home_team} vs ${match.away_team}</td>
                            <td>${pred.home_score}-${pred.away_score} (${pred.minute}')</td>
                            <td>${actualResult}</td>
                            <td>${statusBadge}</td>
                            <td><strong>+${pred.total_points || 0}</strong></td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
            }
            
            document.getElementById('playerDetailModal').classList.add('active');
        }

        // ============================================
        // GROUP CRUD FUNCTIONS
        // ============================================

        var currentEditingGroup = null;

        function openAddGroupModal() {
            currentEditingGroup = null;
            
            document.getElementById('groupName').value = '';
            document.getElementById('groupCode').value = generateGroupCode();
            
            document.getElementById('addGroupModalTitle').textContent = 'T·∫°o nh√≥m m·ªõi';
            document.getElementById('addGroupModal').classList.add('active');
        }

        function generateGroupCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = 'WC2026-';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        async function editGroup(id) {
            // id is already a string (UUID)
            const group = allGroups.find(g => g.id === id);
            if (!group) {
                alert('Kh√¥ng t√¨m th·∫•y nh√≥m!');
                return;
            }
            
            currentEditingGroup = group;
            
            document.getElementById('groupName').value = group.name;
            document.getElementById('groupCode').value = group.code;
            
            document.getElementById('addGroupModalTitle').textContent = 'S·ª≠a th√¥ng tin nh√≥m';
            document.getElementById('addGroupModal').classList.add('active');
        }

        async function saveGroup() {
            const name = document.getElementById('groupName').value.trim();
            const code = document.getElementById('groupCode').value.trim();
            
            if (!name || !code) {
                alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!');
                return;
            }
            
            const groupData = {
                name: name,
                code: code
            };
            
            try {
                if (currentEditingGroup) {
                    // Update existing group
                    const { error } = await supabase
                        .from('groups')
                        .update(groupData)
                        .eq('id', currentEditingGroup.id);
                    
                    if (error) throw error;
                    
                    alert('‚úÖ ƒê√£ c·∫≠p nh·∫≠t nh√≥m!');
                } else {
                    // Create new group
                    const { error } = await supabase
                        .from('groups')
                        .insert([groupData]);
                    
                    if (error) throw error;
                    
                    alert('‚úÖ ƒê√£ t·∫°o nh√≥m m·ªõi!');
                }
                
                await loadGroups();
                await loadPlayers();
                renderGroupsTable();
                renderDashboard();
                closeModal('addGroupModal');
            } catch (error) {
                console.error('Save group error:', error);
                alert('L·ªói: ' + error.message);
            }
        }

        async function deleteGroup(id) {
            // Check if group has members
            const members = allPlayers.filter(p => p.group_id === id);
            
            if (members.length > 0) {
                alert(`Kh√¥ng th·ªÉ x√≥a nh√≥m c√≥ ${members.length} th√†nh vi√™n! Vui l√≤ng chuy·ªÉn h·ªç sang nh√≥m kh√°c tr∆∞·ªõc.`);
                return;
            }
            
            if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a nh√≥m n√†y?')) {
                return;
            }
            
            try {
                const { error } = await supabase
                    .from('groups')
                    .delete()
                    .eq('id', id);
                
                if (error) throw error;
                
                alert('‚úÖ ƒê√£ x√≥a nh√≥m!');
                await loadGroups();
                renderGroupsTable();
                renderDashboard();
            } catch (error) {
                console.error('Delete group error:', error);
                alert('L·ªói: ' + error.message);
            }
        }

        async function viewGroupDetails(id) {
            // id is already a string (UUID)
            const group = allGroups.find(g => g.id === id);
            if (!group) {
                alert('Kh√¥ng t√¨m th·∫•y nh√≥m!');
                return;
            }
            
            const members = allPlayers.filter(p => p.group_id === id);
            
            document.getElementById('groupDetailName').textContent = group.name;
            document.getElementById('groupDetailCode').textContent = group.code;
            document.getElementById('groupDetailMembers').textContent = members.length;
            document.getElementById('groupDetailCreated').textContent = new Date(group.created_at).toLocaleDateString('vi-VN');
            
            // Populate members table
            const tbody = document.getElementById('groupMembersTable');
            
            if (members.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="empty-state">Ch∆∞a c√≥ th√†nh vi√™n n√†o</td></tr>';
            } else {
                // Sort by points
                members.sort((a, b) => (b.total_points || 0) - (a.total_points || 0));
                
                let html = '';
                members.forEach((member, index) => {
                    const playerPredictions = allPredictions.filter(p => p.player_id === member.id).length;
                    
                    html += `
                        <tr>
                            <td>${index + 1}</td>
                            <td><strong>${member.name}</strong></td>
                            <td>${member.total_points || 0}</td>
                            <td>${playerPredictions}</td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
            }
            
            document.getElementById('groupDetailModal').classList.add('active');
        }

        // Modal helper
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        console.log('‚úÖ Admin panel script loaded');
    </script>
</body>
</html>
