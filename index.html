<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D·ª± ƒêo√°n T·ªâ S·ªë World Cup 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Colors */
            --primary-green: #4ADE80;
            --yellow-bg: #FEF3C7;
            --stroke: #E0E0E0;
            --stroke-hover: #D6D6D6;
            --bg-gray: #F5F5F5;
            --white: #FFFFFF;
            --black: #000000;
            --text-dark: #1F2937;
            --text-light: #6B7280;
            --active-tab-bg: #D1D1D1;
            
            /* Spacing */
            --card-gap-h: 16px;
            --card-gap-v: 24px;
            --section-padding: 24px;
            
            /* Border */
            --border-radius: 12px;
            --tab-radius: 40px;
            
            /* Card Size */
            --card-width: 185px;
            --card-height: 208px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: var(--bg-gray);
            color: var(--text-dark);
            min-height: 100vh;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: var(--section-padding);
            padding: 8px;
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 10px 0 rgba(0, 0, 0, 0.05);
        }

        .nav-tab {
            padding: 8px 20px;
            background: transparent;
            border: none;
            border-radius: var(--tab-radius);
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-dark);
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .nav-tab.active {
            background: var(--active-tab-bg);
        }

        .nav-login {
            margin-left: auto;
            padding: 10px 24px;
            background: var(--primary-green);
            color: var(--white);
            border: none;
            border-radius: var(--border-radius);
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .nav-login:hover {
            background: #3BC76C;
        }

        .nav-user-section {
            margin-left: auto;
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .nav-user-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-user-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .nav-logout-btn {
            padding: 10px 20px;
            background: transparent;
            color: var(--text-light);
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-logout-btn:hover {
            background: var(--bg-secondary);
            border-color: var(--text-light);
        }

        /* Page Content */
        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        /* Section */
        .section {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: var(--section-padding);
            margin-bottom: var(--card-gap-v);
            box-shadow: 0 4px 10px 0 rgba(0, 0, 0, 0.05);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--card-gap-v);
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .view-all-btn {
            background: none;
            border: none;
            color: var(--primary-green);
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .view-all-btn:hover {
            color: #3BC76C;
            text-decoration: underline;
        }

        /* Match Cards Grid */
        .matches-scroll {
            display: flex;
            gap: var(--card-gap-h);
            overflow-x: auto;
            padding-bottom: 12px;
            scrollbar-width: thin;
            scrollbar-color: var(--stroke) transparent;
        }

        .matches-scroll::-webkit-scrollbar {
            height: 6px;
        }

        .matches-scroll::-webkit-scrollbar-track {
            background: transparent;
        }

        .matches-scroll::-webkit-scrollbar-thumb {
            background: var(--stroke);
            border-radius: 3px;
        }

        .matches-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(var(--card-width), 1fr));
            gap: var(--card-gap-v) var(--card-gap-h);
        }

        /* Match Card */
        .match-card {
            width: var(--card-width);
            min-width: var(--card-width);
            min-height: var(--card-height);
            background: var(--white);
            border: 1px solid var(--stroke);
            border-radius: var(--border-radius);
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            box-shadow: 0 4px 10px 0 rgba(0, 0, 0, 0.05);
        }

        .match-card:hover:not(.disabled) {
            border-color: var(--stroke-hover);
            box-shadow: 0 6px 14px 0 rgba(0, 0, 0, 0.08);
        }

        .match-card.disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* Favorite Team Card */
        .favorite-team-card {
            width: var(--card-width);
            min-width: var(--card-width);
            min-height: var(--card-height);
            background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
            border: 2px solid #F59E0B;
            border-radius: var(--border-radius);
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            box-shadow: 0 6px 16px 0 rgba(245, 158, 11, 0.3);
        }

        .favorite-team-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px 0 rgba(245, 158, 11, 0.4);
        }

        .favorite-team-card.locked {
            cursor: not-allowed;
            opacity: 0.7;
            background: #E5E7EB;
            border-color: #9CA3AF;
            box-shadow: none;
        }

        .favorite-team-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #F59E0B;
            color: var(--white);
            font-size: 10px;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 4px;
            text-transform: uppercase;
        }

        .favorite-team-icon {
            font-size: 48px;
            text-align: center;
            margin: 8px 0;
        }

        .favorite-team-title {
            font-size: 14px;
            font-weight: 700;
            text-align: center;
            color: #92400E;
        }

        .favorite-team-subtitle {
            font-size: 11px;
            text-align: center;
            color: #78350F;
            line-height: 1.4;
        }

        .favorite-team-deadline {
            font-size: 10px;
            text-align: center;
            color: #B45309;
            font-weight: 600;
            margin-top: 4px;
        }

        .favorite-team-selected {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }

        .favorite-team-selected-flag {
            font-size: 40px;
        }

        .favorite-team-selected-name {
            font-size: 13px;
            font-weight: 700;
            color: #92400E;
            text-align: center;
        }

        .favorite-team-selected-points {
            font-size: 11px;
            color: #78350F;
            text-align: center;
        }

        /* Stats Favorite Team Section */
        .stats-favorite-team {
            background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
            border: 2px solid #F59E0B;
            border-radius: var(--border-radius);
            padding: 16px;
            margin-top: 16px;
        }

        .stats-favorite-team-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .stats-favorite-team-icon {
            font-size: 32px;
        }

        .stats-favorite-team-info {
            flex: 1;
        }

        .stats-favorite-team-name {
            font-size: 16px;
            font-weight: 700;
            color: #92400E;
            margin-bottom: 4px;
        }

        .stats-favorite-team-status {
            font-size: 12px;
            color: #78350F;
        }

        .stats-favorite-team-points {
            background: var(--white);
            border-radius: 8px;
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stats-favorite-team-points-label {
            font-size: 12px;
            color: var(--text-light);
        }

        .stats-favorite-team-points-value {
            font-size: 20px;
            font-weight: 700;
            color: #F59E0B;
        }

        .match-group-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--black);
            color: var(--white);
            font-size: 10px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .match-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            margin-top: 20px;
        }

        .team {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            flex: 1;
        }

        .team-flag {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .team-name {
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            color: var(--text-dark);
        }

        .match-vs {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-light);
        }

        .match-datetime {
            display: flex;
            justify-content: center;
            gap: 12px;
            font-size: 12px;
            color: var(--text-light);
            margin-top: 4px;
        }

        .match-status {
            text-align: center;
            font-size: 12px;
            font-weight: 500;
            padding: 6px;
            border-radius: 6px;
            margin-top: auto;
        }

        .match-status.not-open {
            color: var(--text-light);
            background: var(--bg-gray);
        }

        .match-status.open {
            color: var(--primary-green);
            background: rgba(74, 222, 128, 0.1);
        }

        .match-status.predicted {
            color: var(--primary-green);
            background: rgba(74, 222, 128, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .match-status.live {
            color: #EF4444;
            background: rgba(239, 68, 68, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        /* Live progress bar */
        .live-progress {
            width: 20px;
            height: 3px;
            background: rgba(239, 68, 68, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .live-progress-bar {
            height: 100%;
            background: #EF4444;
            animation: progress 2s ease-in-out infinite;
        }

        @keyframes progress {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Match Score (k·∫øt qu·∫£ th·ª±c t·∫ø) */
        .match-score {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            margin: 12px 0;
        }

        .score-number {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-dark);
        }

        .score-minute {
            font-size: 12px;
            color: var(--text-light);
        }

        /* Match Result (d·ª± ƒëo√°n + ƒëi·ªÉm) */
        .match-result {
            text-align: center;
            font-size: 12px;
            margin-top: auto;
        }

        .prediction-text {
            color: var(--primary-green);
            font-weight: 500;
        }

        .points-text {
            display: flex;
            justify-content: center;
            gap: 4px;
            margin-top: 4px;
            flex-wrap: wrap;
        }

        .point-badge {
            background: var(--yellow-bg);
            color: var(--text-dark);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 24px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-light);
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: var(--bg-gray);
            color: var(--text-dark);
        }

        .modal-teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-team {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .modal-team-flag {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
        }

        .modal-team-name {
            font-size: 14px;
            font-weight: 600;
        }

        .modal-vs {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-light);
        }

        /* Prediction Input */
        .prediction-inputs {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 20px;
            margin: 32px 0;
        }

        .prediction-input-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .prediction-input {
            width: 60px;
            height: 50px;
            font-size: 28px;
            font-weight: 700;
            text-align: center;
            border: none;
            border-bottom: 2px dashed var(--stroke);
            background: transparent;
            font-family: 'Montserrat', sans-serif;
            color: var(--text-dark);
            transition: all 0.2s ease;
            padding: 8px;
        }

        .prediction-input:focus {
            outline: none;
            border-bottom-color: var(--primary-green);
        }

        .prediction-input:disabled {
            background: var(--bg-gray);
            cursor: not-allowed;
            border-bottom-style: solid;
        }

        .prediction-divider {
            font-size: 20px;
            color: var(--text-light);
            margin: 0 8px;
            padding-bottom: 12px;
        }

        .prediction-minute {
            width: 80px;
            height: 50px;
            font-size: 28px;
            font-weight: 700;
            text-align: center;
            border: none;
            border-bottom: 2px dashed var(--stroke);
            background: transparent;
            font-family: 'Montserrat', sans-serif;
            color: var(--text-dark);
            transition: all 0.2s ease;
            padding: 8px;
        }

        .prediction-minute:focus {
            outline: none;
            border-bottom-color: var(--primary-green);
        }

        .prediction-minute:disabled {
            background: var(--bg-gray);
            cursor: not-allowed;
            border-bottom-style: solid;
        }

        .input-label {
            font-size: 11px;
            color: var(--text-light);
            font-weight: 500;
        }

        /* Validation Warning */
        .validation-warning {
            display: none;
            background: #FEF3C7;
            border: 1px solid #F59E0B;
            color: #92400E;
            padding: 12px;
            border-radius: var(--border-radius);
            font-size: 13px;
            margin-top: 16px;
            text-align: center;
        }

        .validation-warning.show {
            display: block;
            animation: shake 0.3s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Login Modal */
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .form-input {
            padding: 12px;
            border: 1px solid var(--stroke);
            border-radius: var(--border-radius);
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            color: var(--text-dark);
            transition: all 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(74, 222, 128, 0.1);
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-wrapper input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-wrapper label {
            font-size: 13px;
            color: var(--text-dark);
            cursor: pointer;
        }

        /* Results Detail Modal */
        .results-modal .modal {
            max-width: 650px;
        }

        .results-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .results-score-display {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 16px 0;
        }

        .results-score-team {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .results-team-flag {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .results-team-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .results-final-score {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .score-main {
            font-size: 36px;
            font-weight: 700;
            color: var(--text-dark);
        }

        .score-detail {
            font-size: 14px;
            color: var(--text-light);
        }

        .results-list-wrapper {
            max-height: 400px;
            overflow-y: auto;
            margin: 16px 0;
            border-radius: var(--border-radius);
            border: 1px solid var(--stroke);
        }

        .results-list-wrapper::-webkit-scrollbar {
            width: 6px;
        }

        .results-list-wrapper::-webkit-scrollbar-track {
            background: var(--bg-gray);
        }

        .results-list-wrapper::-webkit-scrollbar-thumb {
            background: var(--stroke);
            border-radius: 3px;
        }

        .results-list-wrapper::-webkit-scrollbar-thumb:hover {
            background: var(--stroke-hover);
        }

        .result-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-bottom: 1px solid var(--stroke);
            transition: background 0.2s ease;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-item.current-user {
            background: var(--yellow-bg);
        }

        .result-rank {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            flex-shrink: 0;
        }

        .result-rank.rank-1 { background: #FFD700; color: var(--black); }
        .result-rank.rank-2 { background: #C0C0C0; color: var(--black); }
        .result-rank.rank-3 { background: #CD7F32; color: var(--white); }
        .result-rank.rank-4 { background: #6B7280; color: var(--white); }
        .result-rank.rank-other { background: var(--bg-gray); color: var(--text-dark); }

        .result-player {
            flex: 1;
            min-width: 0;
        }

        .result-player-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .result-prediction {
            font-size: 13px;
            color: var(--primary-green);
            font-weight: 500;
        }

        .result-points {
            display: flex;
            align-items: center;
            gap: 4px;
            flex-shrink: 0;
        }

        .point-icon {
            display: inline-flex;
            align-items: center;
            gap: 2px;
            font-size: 12px;
            font-weight: 600;
            padding: 4px 6px;
            border-radius: 4px;
            background: var(--bg-gray);
        }

        .point-icon.rank-point {
            background: rgba(74, 222, 128, 0.15);
            color: var(--primary-green);
        }

        .point-icon.exact-score {
            background: rgba(239, 68, 68, 0.15);
            color: #EF4444;
        }

        .point-icon.minute-point {
            background: rgba(59, 130, 246, 0.15);
            color: #3B82F6;
        }

        .point-icon.zero {
            background: var(--bg-gray);
            color: var(--text-light);
        }

        /* Modal Actions */
        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: var(--border-radius);
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: var(--primary-green);
            color: var(--white);
        }

        .btn-primary:hover:not(:disabled) {
            background: #3BC76C;
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: var(--white);
            color: var(--text-dark);
            border: 2px solid var(--stroke);
        }

        .btn-secondary:hover {
            background: var(--bg-gray);
        }

        /* Success Animation */
        .success-checkmark {
            display: none;
            width: 60px;
            height: 60px;
            margin: 20px auto;
        }

        .success-checkmark.show {
            display: block;
            animation: scaleIn 0.3s ease;
        }

        @keyframes scaleIn {
            0% {
                transform: scale(0);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }

        .checkmark-circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 2;
            stroke: var(--primary-green);
            fill: none;
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }

        .checkmark-check {
            transform-origin: 50% 50%;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            stroke: var(--primary-green);
            animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.4s forwards;
        }

        @keyframes stroke {
            100% {
                stroke-dashoffset: 0;
            }
        }

        /* Leaderboard Table */
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
        }

        .leaderboard-table thead {
            background: var(--primary-green);
        }

        .leaderboard-table th {
            padding: 12px;
            text-align: left;
            font-size: 12px;
            font-weight: 600;
            color: var(--white);
        }

        .leaderboard-table th:first-child {
            border-radius: var(--border-radius) 0 0 0;
        }

        .leaderboard-table th:last-child {
            border-radius: 0 var(--border-radius) 0 0;
        }

        .leaderboard-table td {
            padding: 12px;
            font-size: 14px;
            border-bottom: 1px solid var(--stroke);
        }

        .leaderboard-table tbody tr:nth-child(odd) {
            background: var(--yellow-bg);
        }

        .leaderboard-table tbody tr:hover {
            background: rgba(74, 222, 128, 0.1);
        }

        .rank-badge {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }

        .rank-1 { background: #FFD700; color: var(--black); }
        .rank-2 { background: #C0C0C0; color: var(--black); }
        .rank-3 { background: #CD7F32; color: var(--white); }
        .rank-4 { background: #6B7280; color: var(--white); }
        .rank-other { background: var(--primary-green); color: var(--white); }

        .player-name {
            color: #2563EB;
            font-weight: 600;
            cursor: pointer;
        }

        .player-name:hover {
            text-decoration: underline;
        }

        /* Stats Cards */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--card-gap-h);
            margin-bottom: var(--card-gap-v);
        }

        .stat-card {
            background: var(--white);
            border: 1px solid var(--stroke);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 10px 0 rgba(0, 0, 0, 0.05);
        }

        .stat-number {
            font-size: 48px;
            font-weight: 700;
            color: var(--text-dark);
            line-height: 1;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-light);
            font-weight: 500;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .matches-grid {
                grid-template-columns: repeat(auto-fill, minmax(calc(var(--card-width) * 0.9), 1fr));
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }

            .nav-tabs {
                overflow-x: auto;
                scrollbar-width: none;
            }

            .nav-tabs::-webkit-scrollbar {
                display: none;
            }

            .matches-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            }

            .homepage-grid {
                grid-template-columns: 1fr !important;
            }

            --card-width: 160px;
        }
    </style>
    <!-- Supabase CDN - ONLY external script -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="container">
        <!-- Navigation -->
        <nav class="nav-tabs">
            <button class="nav-tab active" onclick="switchPage('homepage')" style="padding: 8px 12px;">üè†</button>
            <button class="nav-tab" onclick="switchPage('schedule')">üìÖ L·ªãch thi ƒë·∫•u</button>
            <button class="nav-tab" onclick="switchPage('leaderboard')">üèÜ B·∫£ng x·∫øp h·∫°ng</button>
            <div class="nav-user-section" id="navUserSection" style="display: none;">
                <button class="nav-user-btn" onclick="openProfilePage()" id="navUserBtn">User</button>
                <button class="nav-logout-btn" onclick="handleLogout()">ƒêƒÉng xu·∫•t</button>
            </div>
            <button class="nav-login" id="navLoginBtn" onclick="openLoginModal()">ƒêƒÉng nh·∫≠p</button>
        </nav>

        <!-- Homepage -->
        <div id="homepage" class="page-content active">
            <!-- Tr·∫≠n ƒë·∫•u s·∫Øp di·ªÖn ra -->
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">üèüÔ∏è TR·∫¨N ƒê·∫§U S·∫ÆP DI·ªÑN RA</h2>
                    <button class="view-all-btn" onclick="switchPage('schedule')">XEM T·∫§T C·∫¢</button>
                </div>
                <div class="matches-scroll" id="upcomingMatches">
                    <!-- S·∫Ω ƒë∆∞·ª£c t·∫°o b·∫±ng JavaScript -->
                </div>
            </section>

            <div class="homepage-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                <!-- B·∫£ng x·∫øp h·∫°ng -->
                <section class="section">
                    <div class="section-header">
                        <h2 class="section-title">üèÜ B·∫¢NG X·∫æP H·∫†NG</h2>
                    </div>
                    <div id="leaderboardPreview">
                        <!-- S·∫Ω ƒë∆∞·ª£c t·∫°o b·∫±ng JavaScript -->
                    </div>
                </section>

                <!-- Th√†nh t√≠ch c√° nh√¢n -->
                <section class="section">
                    <div class="section-header">
                        <h2 class="section-title">üë§ TH√ÄNH T√çCH C√Å NH√ÇN</h2>
                    </div>
                    <div class="stats-row" id="personalStatsCards">
                        <!-- Will be populated by JavaScript -->
                    </div>
                    
                    <!-- Favorite Team Stats -->
                    <div id="statsFavoriteTeam"></div>
                    
                    <!-- Chart v√† l·ªãch s·ª≠ s·∫Ω th√™m sau -->
                </section>
            </div>

            <!-- L·ªãch s·ª≠ -->
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">üìä L·ªäCH S·ª¨</h2>
                    <button class="view-all-btn" onclick="scrollToPersonalStats()">XEM T·∫§T C·∫¢</button>
                </div>
                <div class="matches-scroll" id="historyMatches">
                    <!-- S·∫Ω ƒë∆∞·ª£c t·∫°o b·∫±ng JavaScript -->
                </div>
            </section>
        </div>

        <!-- L·ªãch thi ƒë·∫•u Page -->
        <div id="schedule" class="page-content">
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">üèüÔ∏è TR·∫¨N ƒê·∫§U S·∫ÆP DI·ªÑN RA V√íNG N√ÄY</h2>
                </div>
                <div class="matches-grid" id="scheduleMatches">
                    <!-- S·∫Ω ƒë∆∞·ª£c t·∫°o b·∫±ng JavaScript -->
                </div>
            </section>

            <!-- Stats summary -->
            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-number">16</div>
                    <div class="stat-label">TR·∫¨N</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">92</div>
                    <div class="stat-label">C√íN L·∫†I</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">140</div>
                    <div class="stat-label">‚öΩ B√ÄN TH·∫ÆNG</div>
                </div>
            </div>
        </div>

        <!-- B·∫£ng x·∫øp h·∫°ng Page -->
        <div id="leaderboard" class="page-content">
            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">üèÜ B·∫¢NG X·∫æP H·∫†NG</h2>
                </div>
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>H·∫°ng</th>
                            <th>Ng∆∞·ªùi ch∆°i</th>
                            <th>ƒêi·ªÉm</th>
                            <th>Top 1</th>
                            <th>ƒê√∫ng t·ªâ s·ªë</th>
                            <th>ƒê√∫ng s·ªë ph√∫t</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardTable">
                        <!-- S·∫Ω ƒë∆∞·ª£c t·∫°o b·∫±ng JavaScript -->
                    </tbody>
                </table>
            </section>

            <div id="personalStatsSection">
                <div class="stats-row">
                    <div class="stat-card">
                        <div class="stat-number">2</div>
                        <div class="stat-label">üèÜ V·ªä TR√ç</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">120</div>
                        <div class="stat-label">üìä ƒêI·ªÇM</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">4</div>
                        <div class="stat-label">üéØ T·ªà S·ªê</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">4</div>
                        <div class="stat-label">ü•á NH·∫§T</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Page -->
    <div id="profile" class="page-content">
        <section class="section">
            <div class="section-header">
                <h2 class="section-title">üë§ TRANG C√Å NH√ÇN</h2>
            </div>
            
            <!-- Personal Stats -->
            <div class="stats-row" id="profileStatsCards">
                <!-- Will be populated by JavaScript -->
            </div>
            
            <!-- Favorite Team Section -->
            <div style="margin-top: 24px;">
                <h3 style="font-size: 18px; margin-bottom: 16px; color: var(--text);">‚≠ê ƒê·ªôi Y√™u Th√≠ch</h3>
                <div id="profileFavoriteTeam">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Prediction History -->
            <div style="margin-top: 24px;">
                <h3 style="font-size: 18px; margin-bottom: 16px; color: var(--text);">üìä L·ªãch S·ª≠ D·ª± ƒêo√°n</h3>
                <div id="profilePredictionHistory">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </section>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="predictionModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">D·ª± ƒëo√°n t·ªâ s·ªë</h3>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>

            <div class="modal-teams">
                <div class="modal-team">
                    <div class="modal-team-flag" id="modalHomeFlag"></div>
                    <div class="modal-team-name" id="modalHomeName"></div>
                </div>
                <div class="modal-vs">vs</div>
                <div class="modal-team">
                    <div class="modal-team-flag" id="modalAwayFlag"></div>
                    <div class="modal-team-name" id="modalAwayName"></div>
                </div>
            </div>

            <div class="prediction-inputs">
                <div class="prediction-input-wrapper">
                    <input type="number" class="prediction-input" id="inputHomeScore" min="0" max="20" value="2">
                    <span class="input-label">Nh√†</span>
                </div>
                <div class="prediction-input-wrapper">
                    <input type="number" class="prediction-minute" id="inputMinute" min="0" max="90" value="45">
                    <span class="input-label">Ph√∫t</span>
                </div>
                <div class="prediction-input-wrapper">
                    <input type="number" class="prediction-input" id="inputAwayScore" min="0" max="20" value="0">
                    <span class="input-label">Kh√°ch</span>
                </div>
            </div>

            <div class="validation-warning" id="validationWarning">
                ‚ö†Ô∏è T·ªâ s·ªë 0-0 th√¨ s·ªë ph√∫t ph·∫£i l√† 0
            </div>

            <svg class="success-checkmark" id="successCheckmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
                <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
            </svg>

            <div class="modal-actions" id="modalActions">
                <button class="btn btn-primary" id="btnConfirm" onclick="confirmPrediction()">X√°c nh·∫≠n</button>
                <button class="btn btn-secondary" id="btnEdit" onclick="editPrediction()" style="display: none;">Ch·ªânh s·ª≠a</button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">ƒêƒÉng nh·∫≠p</h3>
                <button class="modal-close" onclick="closeLoginModal()">√ó</button>
            </div>

            <form class="login-form" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label">T√™n c·ªßa b·∫°n</label>
                    <input type="text" class="form-input" id="loginName" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n" required>
                </div>

                <div class="form-group">
                    <label class="form-label">M·∫≠t kh·∫©u</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" required>
                </div>

                <div class="form-group">
                    <label class="form-label">M√£ nh√≥m</label>
                    <input type="text" class="form-input" id="loginGroupCode" placeholder="Nh·∫≠p m√£ nh√≥m" required>
                </div>

                <div class="checkbox-wrapper">
                    <input type="checkbox" id="rememberMe">
                    <label for="rememberMe">Ghi nh·ªõ ƒëƒÉng nh·∫≠p</label>
                </div>

                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">ƒêƒÉng nh·∫≠p</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Results Detail Modal -->
    <div class="modal-overlay results-modal" id="resultsModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">D·ª± ƒëo√°n t·ªâ s·ªë</h3>
                <button class="modal-close" onclick="closeResultsModal()">√ó</button>
            </div>

            <div class="results-header">
                <div class="results-score-display">
                    <div class="results-score-team">
                        <div class="results-team-flag" id="resultsHomeFlag"></div>
                        <div class="results-team-name" id="resultsHomeName"></div>
                    </div>
                    <div class="results-final-score">
                        <div class="score-main" id="resultsHomeScore">2</div>
                    </div>
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 0 16px;">
                        <div style="font-size: 18px; color: var(--text-light); font-weight: 500;">vs</div>
                        <div class="score-detail" id="resultsMinute">82'</div>
                    </div>
                    <div class="results-final-score">
                        <div class="score-main" id="resultsAwayScore">0</div>
                    </div>
                    <div class="results-score-team">
                        <div class="results-team-flag" id="resultsAwayFlag"></div>
                        <div class="results-team-name" id="resultsAwayName"></div>
                    </div>
                </div>
            </div>

            <div class="results-list-wrapper">
                <div id="resultsList">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Favorite Team Modal -->
    <div class="modal-overlay" id="favoriteTeamModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">‚≠ê Ch·ªçn ƒê·ªôi Y√™u Th√≠ch</h3>
                <button class="modal-close" onclick="closeFavoriteTeamModal()">√ó</button>
            </div>

            <div style="padding: 16px; background: var(--yellow-bg); border-radius: 8px; margin-bottom: 20px;">
                <div style="font-size: 13px; color: #78350F; line-height: 1.5;">
                    <strong>C√°ch ho·∫°t ƒë·ªông:</strong><br>
                    Ch·ªçn 1 ƒë·ªôi. ƒê·ªôi ƒë√≥ ƒëi c√†ng s√¢u ‚Üí ƒêi·ªÉm bonus c√†ng cao!<br>
                    B·∫°n c√≥ th·ªÉ ƒë·ªïi ƒë·ªôi cho ƒë·∫øn <strong id="favoriteDeadlineText"></strong>
                </div>
            </div>

            <div class="form-group" style="margin-bottom: 20px;">
                <label class="form-label">T√¨m ki·∫øm ƒë·ªôi</label>
                <input 
                    type="text" 
                    class="form-input" 
                    id="favoriteTeamSearch" 
                    placeholder="G√µ t√™n ƒë·ªôi... (VD: Argentina, Brasil)"
                    style="width: 100%;"
                >
            </div>

            <div id="favoriteTeamList" style="max-height: 300px; overflow-y: auto; margin-bottom: 20px;">
                <!-- Will be populated by JavaScript -->
            </div>

            <div id="favoriteTeamSelected" style="display: none; padding: 16px; background: var(--bg-gray); border-radius: 8px; margin-bottom: 20px;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="font-size: 40px;" id="selectedTeamFlag"></div>
                    <div style="flex: 1;">
                        <div style="font-size: 16px; font-weight: 700; color: var(--text-dark); margin-bottom: 4px;" id="selectedTeamName"></div>
                        <div style="font-size: 12px; color: var(--text-light);" id="selectedTeamPoints"></div>
                    </div>
                </div>
            </div>

            <svg class="success-checkmark" id="favoriteSuccessCheckmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
                <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
            </svg>

            <div class="modal-actions" id="favoriteTeamActions">
                <button class="btn btn-secondary" onclick="closeFavoriteTeamModal()">H·ªßy</button>
                <button class="btn btn-primary" id="btnConfirmFavorite" onclick="confirmFavoriteTeam()" disabled>X√°c nh·∫≠n</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // INLINE CONFIG (No external config.js)
        // ============================================
        
        const SUPABASE_CONFIG = {
          url: 'https://bzgfmvxgfgpzinnstgdm.supabase.co',
          anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ6Z2ZtdnhnZmdwemlubnN0Z2RtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1NjUyOTUsImV4cCI6MjA4NjE0MTI5NX0.in-jeMj88CES1pabN7cqNpIQeTeshCeiTgvauqQbcuM'
        };
        
        const DEMO_GROUP_CODE = 'WC2026-DEMO';
        
        // ============================================
        // INLINE SUPABASE FUNCTIONS (No external supabase-db.js)
        // ============================================
        
        // Initialize Supabase Client
        // Use var instead of const to allow re-declaration in GitHub preview
        var supabase = window.supabase.createClient(
          SUPABASE_CONFIG.url,
          SUPABASE_CONFIG.anonKey
        );
        
        // Current user state  
        var currentUser = null;
        var currentGroup = null;
        
        // AUTHENTICATION FUNCTIONS
        async function loginUser(email, password) {
          try {
            const { data: player, error } = await supabase
              .from('players')
              .select('*')
              .eq('email', email)
              .eq('password', password)
              .single();
            
            if (error) throw error;
            
            currentUser = player;
            localStorage.setItem('currentUserId', player.id);
            
            return { success: true, player };
          } catch (error) {
            console.error('Login error:', error);
            return { success: false, error: error.message };
          }
        }
        
        async function logoutUser() {
          currentUser = null;
          currentGroup = null;
          localStorage.removeItem('currentUserId');
        }
        
        async function getCurrentUser() {
          const userId = localStorage.getItem('currentUserId');
          if (!userId) return null;
          
          try {
            const { data: player, error } = await supabase
              .from('players')
              .select('*')
              .eq('id', userId)
              .single();
            
            if (error) throw error;
            
            currentUser = player;
            return player;
          } catch (error) {
            console.error('Get current user error:', error);
            return null;
          }
        }
        
        // GROUP FUNCTIONS
        async function getGroupByCode(code) {
          try {
            const { data: group, error } = await supabase
              .from('groups')
              .select('*')
              .eq('code', code)
              .single();
            
            if (error) throw error;
            
            currentGroup = group;
            return group;
          } catch (error) {
            console.error('Get group error:', error);
            return null;
          }
        }
        
        // MATCH FUNCTIONS
        async function getMatches(groupId) {
          try {
            const { data: matches, error } = await supabase
              .from('matches')
              .select('*')
              .order('match_date', { ascending: true });
            
            if (error) throw error;
            
            return matches || [];
          } catch (error) {
            console.error('Get matches error:', error);
            return [];
          }
        }
        
        async function createMatch(groupId, matchData) {
          try {
            const { data: match, error } = await supabase
              .from('matches')
              .insert({
                group_id: groupId,
                match_group: matchData.group,
                home_team: matchData.home,
                away_team: matchData.away,
                match_date: matchData.date,
                status: matchData.status || 'not-open'
              })
              .select()
              .single();
            
            if (error) throw error;
            
            return { success: true, match };
          } catch (error) {
            console.error('Create match error:', error);
            return { success: false, error: error.message };
          }
        }
        
        async function updateMatchStatus(matchId, status) {
          try {
            const { data: match, error } = await supabase
              .from('matches')
              .update({ status })
              .eq('id', matchId)
              .select()
              .single();
            
            if (error) throw error;
            
            return { success: true, match };
          } catch (error) {
            console.error('Update match status error:', error);
            return { success: false, error: error.message };
          }
        }
        
        async function enterMatchResult(matchId, homeScore, awayScore, minute) {
          try {
            const { data: match, error } = await supabase
              .from('matches')
              .update({
                status: 'finished',
                home_score: homeScore,
                away_score: awayScore,
                minute: minute
              })
              .eq('id', matchId)
              .select()
              .single();
            
            if (error) throw error;
            
            return { success: true, match };
          } catch (error) {
            console.error('Enter match result error:', error);
            return { success: false, error: error.message };
          }
        }
        
        // PREDICTION FUNCTIONS
        async function getPrediction(matchId, playerId) {
          try {
            const { data: prediction, error } = await supabase
              .from('predictions')
              .select('*')
              .eq('match_id', matchId)
              .eq('player_id', playerId)
              .maybeSingle();
            
            if (error && error.code !== 'PGRST116') throw error;
            
            return prediction;
          } catch (error) {
            console.error('Get prediction error:', error);
            return null;
          }
        }
        
        async function savePrediction(matchId, playerId, homeScore, awayScore, minute) {
          try {
            const { data: prediction, error } = await supabase
              .from('predictions')
              .upsert({
                match_id: matchId,
                player_id: playerId,
                home_score: homeScore,
                away_score: awayScore,
                minute: minute,
                updated_at: new Date().toISOString()
              }, {
                onConflict: 'match_id,player_id'
              })
              .select()
              .single();
            
            if (error) throw error;
            
            return { success: true, prediction };
          } catch (error) {
            console.error('Save prediction error:', error);
            return { success: false, error: error.message };
          }
        }
        
        async function getPlayerPredictions(playerId) {
          try {
            const { data: predictions, error } = await supabase
              .from('predictions')
              .select(`
                *,
                matches (*)
              `)
              .eq('player_id', playerId);
            
            if (error) throw error;
            
            return predictions || [];
          } catch (error) {
            console.error('Get player predictions error:', error);
            return [];
          }
        }
        
        // Get all predictions for a match (all players in group)
        async function getMatchPredictions(matchId) {
          try {
            const { data: predictions, error } = await supabase
              .from('predictions')
              .select(`
                *,
                players!inner (
                  id,
                  name,
                  group_id
                )
              `)
              .eq('match_id', matchId)
              .eq('players.group_id', groupId);
            
            if (error) throw error;
            
            return (predictions || []).map(p => ({
              ...p,
              player_name: p.players.name,
              player_id: p.players.id
            }));
          } catch (error) {
            console.error('Get match predictions error:', error);
            return [];
          }
        }
        
        // LEADERBOARD FUNCTIONS
        async function getLeaderboard(groupId) {
          try {
            const { data: players, error } = await supabase
              .from('players')
              .select(`
                id,
                name,
                predictions (
                  total_points,
                  points_rank,
                  points_exact_score,
                  points_minute
                )
              `)
              .eq('group_id', groupId);
            
            if (error) throw error;
            
            const leaderboard = players.map(player => {
              const predictions = player.predictions || [];
              const totalPoints = predictions.reduce((sum, p) => sum + (p.total_points || 0), 0);
              const top1Count = predictions.filter(p => p.points_rank === 4).length;
              const exactScoreCount = predictions.filter(p => p.points_exact_score > 0).length;
              const exactMinuteCount = predictions.filter(p => p.points_minute > 0).length;
              
              return {
                id: player.id,
                name: player.name,
                points: totalPoints,
                top1: top1Count,
                exactScore: exactScoreCount,
                exactMinute: exactMinuteCount
              };
            });
            
            leaderboard.sort((a, b) => b.points - a.points);
            leaderboard.forEach((player, index) => {
              player.rank = index + 1;
            });
            
            return leaderboard;
          } catch (error) {
            console.error('Get leaderboard error:', error);
            return [];
          }
        }
        
        // FAVORITE TEAM FUNCTIONS
        async function getFavoriteTeamSettings(groupId) {
          try {
            const { data: group, error } = await supabase
              .from('groups')
              .select('favorite_team_enabled, favorite_team_locked, favorite_team_deadline, points_round16, points_quarter, points_semi, points_final, points_champion')
              .eq('id', groupId)
              .single();
            
            if (error) throw error;
            
            return group;
          } catch (error) {
            console.error('Get favorite team settings error:', error);
            return null;
          }
        }
        
        async function selectFavoriteTeam(playerId, teamName) {
          try {
            const { data: player, error } = await supabase
              .from('players')
              .update({
                favorite_team: teamName,
                favorite_team_status: 'active'
              })
              .eq('id', playerId)
              .select()
              .single();
            
            if (error) throw error;
            
            return { success: true, player };
          } catch (error) {
            console.error('Select favorite team error:', error);
            return { success: false, error: error.message };
          }
        }
        
        async function updateFavoriteTeamSettings(groupId, settings) {
          try {
            const { data: group, error } = await supabase
              .from('groups')
              .update(settings)
              .eq('id', groupId)
              .select()
              .single();
            
            if (error) throw error;
            
            return { success: true, group };
          } catch (error) {
            console.error('Update favorite team settings error:', error);
            return { success: false, error: error.message };
          }
        }
        
        // PLAYER FUNCTIONS
        async function getPlayers(groupId) {
          try {
            const { data: players, error } = await supabase
              .from('players')
              .select('*')
              .eq('group_id', groupId);
            
            if (error) throw error;
            
            return players || [];
          } catch (error) {
            console.error('Get players error:', error);
            return [];
          }
        }
        
        async function createPlayer(groupId, name, email, password, isAdmin = false) {
          try {
            const { data: player, error } = await supabase
              .from('players')
              .insert({
                group_id: groupId,
                name,
                email,
                password,
                is_admin: isAdmin
              })
              .select()
              .single();
            
            if (error) throw error;
            
            return { success: true, player };
          } catch (error) {
            console.error('Create player error:', error);
            return { success: false, error: error.message };
          }
        }
        
        console.log('‚úÖ Supabase client initialized');
        console.log('üìä Database:', SUPABASE_CONFIG.url);
        console.log('‚úÖ All functions ready!');
        
        // ============================================
        // APP LOGIC STARTS HERE
        // ============================================
        
        // ============================================
        // GLOBAL STATE
        // ============================================
        
        const countries = {
            // WC 2026 Hosts
            'Canada': { flag: 'üá®üá¶', color: '#FEE2E2' },
            'Mexico': { flag: 'üá≤üáΩ', color: '#D1FAE5' },
            'United States': { flag: 'üá∫üá∏', color: '#DBEAFE' },
            
            // Europe - Qualified
            'Austria': { flag: 'üá¶üáπ', color: '#FEE2E2' },
            'Belgium': { flag: 'üáßüá™', color: '#FEF3C7' },
            'Croatia': { flag: 'üá≠üá∑', color: '#FEE2E2' },
            'England': { flag: 'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø', color: '#E0E0E0' },
            'France': { flag: 'üá´üá∑', color: '#DBEAFE' },
            'Germany': { flag: 'üá©üá™', color: '#FEF3C7' },
            'Netherlands': { flag: 'üá≥üá±', color: '#FEE2E2' },
            'Norway': { flag: 'üá≥üá¥', color: '#FEE2E2' },
            'Portugal': { flag: 'üáµüáπ', color: '#D1FAE5' },
            'Scotland': { flag: 'üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø', color: '#DBEAFE' },
            'Spain': { flag: 'üá™üá∏', color: '#FEF3C7' },
            'Switzerland': { flag: 'üá®üá≠', color: '#FEE2E2' },
            
            // Europe - Playoffs
            'Italy': { flag: 'üáÆüáπ', color: '#D1FAE5' },
            'Poland': { flag: 'üáµüá±', color: '#FEE2E2' },
            'Ukraine': { flag: 'üá∫üá¶', color: '#FEF3C7' },
            'Sweden': { flag: 'üá∏üá™', color: '#DBEAFE' },
            'Albania': { flag: 'üá¶üá±', color: '#FEE2E2' },
            'Wales': { flag: 'üè¥Û†ÅßÛ†Å¢Û†Å∑Û†Å¨Û†Å≥Û†Åø', color: '#D1FAE5' },
            'Turkey': { flag: 'üáπüá∑', color: '#FEE2E2' },
            'Romania': { flag: 'üá∑üá¥', color: '#DBEAFE' },
            
            // Asia - Qualified
            'Australia': { flag: 'üá¶üá∫', color: '#DBEAFE' },
            'Iran': { flag: 'üáÆüá∑', color: '#D1FAE5' },
            'Japan': { flag: 'üáØüáµ', color: '#FEE2E2' },
            'Jordan': { flag: 'üáØüá¥', color: '#FEE2E2' },
            'Qatar': { flag: 'üá∂üá¶', color: '#FEE2E2' },
            'Saudi Arabia': { flag: 'üá∏üá¶', color: '#D1FAE5' },
            'South Korea': { flag: 'üá∞üá∑', color: '#FEE2E2' },
            'Uzbekistan': { flag: 'üá∫üáø', color: '#DBEAFE' },
            
            // Africa
            'Cape Verde': { flag: 'üá®üáª', color: '#DBEAFE' },
            'Morocco': { flag: 'üá≤üá¶', color: '#FEE2E2' },
            'Nigeria': { flag: 'üá≥üá¨', color: '#D1FAE5' },
            'Senegal': { flag: 'üá∏üá≥', color: '#D1FAE5' },
            'Tunisia': { flag: 'üáπüá≥', color: '#FEE2E2' },
            'Egypt': { flag: 'üá™üá¨', color: '#FEE2E2' },
            'Ghana': { flag: 'üá¨üá≠', color: '#FEF3C7' },
            'Cameroon': { flag: 'üá®üá≤', color: '#FEF3C7' },
            'Ivory Coast': { flag: 'üá®üáÆ', color: '#FEF3C7' },
            
            // CONCACAF
            'Cura√ßao': { flag: 'üá®üáº', color: '#DBEAFE' },
            'Haiti': { flag: 'üá≠üáπ', color: '#FEE2E2' },
            'Panama': { flag: 'üáµüá¶', color: '#FEE2E2' },
            
            // Oceania
            'New Zealand': { flag: 'üá≥üáø', color: '#DBEAFE' },
            
            // South America
            'Argentina': { flag: 'üá¶üá∑', color: '#DBEAFE' },
            'Brasil': { flag: 'üáßüá∑', color: '#D1FAE5' },
            'Uruguay': { flag: 'üá∫üáæ', color: '#DBEAFE' },
            'Colombia': { flag: 'üá®üá¥', color: '#FEF3C7' },
            'Chile': { flag: 'üá®üá±', color: '#FEE2E2' },
            'Ecuador': { flag: 'üá™üá®', color: '#FEF3C7' },
            'Peru': { flag: 'üáµüá™', color: '#FEE2E2' },
            'Venezuela': { flag: 'üáªüá™', color: '#FEF3C7' },
            
            // Popular others
            'Vietnam': { flag: 'üáªüá≥', color: '#FEE2E2' },
            'Thailand': { flag: 'üáπüá≠', color: '#FEE2E2' },
            'Indonesia': { flag: 'üáÆüá©', color: '#FEE2E2' },
            'Malaysia': { flag: 'üá≤üáæ', color: '#FEE2E2' },
            'China': { flag: 'üá®üá≥', color: '#FEE2E2' },
            'India': { flag: 'üáÆüá≥', color: '#FEF3C7' },
            'Denmark': { flag: 'üá©üá∞', color: '#FEE2E2' },
            'Greece': { flag: 'üá¨üá∑', color: '#DBEAFE' },
            'Czech Republic': { flag: 'üá®üáø', color: '#FEE2E2' },
            'Hungary': { flag: 'üá≠üá∫', color: '#D1FAE5' },
            'Serbia': { flag: 'üá∑üá∏', color: '#FEE2E2' },
            'Iceland': { flag: 'üáÆüá∏', color: '#DBEAFE' },
            'Ireland': { flag: 'üáÆüá™', color: '#D1FAE5' },
            'Russia': { flag: 'üá∑üá∫', color: '#DBEAFE' },
            'South Africa': { flag: 'üáøüá¶', color: '#FEF3C7' }
        };

        // Global state
        let matches = [];
        let myPredictions = {};
        let selectedMatch = null;
        let isEditMode = false;
        let groupId = null;
        let currentPlayer = null;
        let favoriteTeamSettings = null;
        let leaderboardData = [];

        console.log('üöÄ App initializing...');

        // ============================================
        // INIT APP - OPTIMIZED LOGIC
        // ============================================
        
        async function initApp() {
            console.log('üìä Loading app...');
            
            try {
                // STEP 1: Load GLOBAL data (matches - same for all groups)
                console.log('üì• Loading matches (global)...');
                await loadMatchesGlobal();
                console.log('‚úÖ Matches loaded');
                
                // STEP 2: Check login (optional)
                try {
                    currentPlayer = await getCurrentUser();
                    
                    if (currentPlayer) {
                        console.log('‚úÖ User logged in:', currentPlayer.name);
                        
                        // Get group ID from user profile
                        groupId = currentPlayer.group_id;
                        console.log('‚úÖ Group ID:', groupId);
                        
                        updateUIForLoggedInUser();
                        
                        // Load GROUP-SPECIFIC data
                        await Promise.all([
                            loadMyPredictions(),
                            loadLeaderboard(),
                            loadFavoriteTeamSettings()
                        ]);
                        
                        console.log('‚úÖ Personal & group data loaded');
                    } else {
                        console.log('‚ÑπÔ∏è Guest mode - matches visible, login to compete');
                        updateUIForGuestUser();
                    }
                } catch (loginError) {
                    // Login check failed - continue as guest
                    console.log('‚ÑπÔ∏è Login check failed, continuing as guest');
                    console.error('Login error:', loginError);
                    updateUIForGuestUser();
                }
                
                // STEP 3: Render UI
                renderAllPages();
                console.log('‚úÖ App ready!');
                
            } catch (error) {
                console.error('‚ùå Init error:', error);
                alert('L·ªói khi t·∫£i d·ªØ li·ªáu: ' + error.message);
            }
        }

        // ============================================
        // DATA LOADING
        // ============================================
        
        async function loadMatchesGlobal() {
            try {
                // Load ALL matches (not filtered by group)
                // Admin creates matches, all groups see them
                const dbMatches = await getMatches(); // No groupId param!
                
                console.log('‚úÖ Loaded', dbMatches.length, 'matches');
                
                // Convert database matches to app format
                matches = dbMatches.map(m => ({
                    id: m.id,
                    group: m.match_group,
                    home: m.home_team,
                    away: m.away_team,
                    date: new Date(m.match_date),
                    status: m.status,
                    actualScore: m.status === 'finished' ? {
                        homeScore: m.home_score,
                        awayScore: m.away_score,
                        minute: m.minute
                    } : null,
                    userPrediction: null, // Will be loaded after login
                    points: null
                }));
                
            } catch (error) {
                console.error('‚ùå Error loading matches:', error);
                throw error;
            }
        }

        async function loadMyPredictions() {
            console.log('üì• Loading my predictions...');
            
            try {
                const predictions = await getPlayerPredictions(currentPlayer.id);
                console.log('‚úÖ Loaded', predictions.length, 'predictions');
                
                // Map predictions to matches
                predictions.forEach(pred => {
                    const match = matches.find(m => m.id === pred.match_id);
                    if (match) {
                        match.userPrediction = {
                            homeScore: pred.home_score,
                            awayScore: pred.away_score,
                            minute: pred.minute
                        };
                        
                        if (match.status === 'finished') {
                            match.points = {
                                rank: pred.points_rank || 0,
                                exactScore: pred.points_exact_score || 0,
                                minute: pred.points_minute || 0
                            };
                        }
                    }
                    
                    myPredictions[pred.match_id] = pred;
                });
                
            } catch (error) {
                console.error('‚ùå Error loading predictions:', error);
            }
        }

        async function loadLeaderboard() {
            console.log('üì• Loading leaderboard...');
            
            try {
                leaderboardData = await getLeaderboard(groupId);
                console.log('‚úÖ Loaded leaderboard:', leaderboardData.length, 'players');
            } catch (error) {
                console.error('‚ùå Error loading leaderboard:', error);
            }
        }

        async function loadFavoriteTeamSettings() {
            console.log('üì• Loading favorite team settings...');
            
            try {
                const settings = await getFavoriteTeamSettings(groupId);
                
                favoriteTeamSettings = {
                    isEnabled: settings.favorite_team_enabled,
                    isLocked: settings.favorite_team_locked,
                    deadline: settings.favorite_team_deadline ? new Date(settings.favorite_team_deadline) : null,
                    selectedTeam: currentPlayer?.favorite_team || null,
                    teamStatus: currentPlayer?.favorite_team_status || null,
                    points: {
                        round16: settings.points_round16,
                        quarter: settings.points_quarter,
                        semi: settings.points_semi,
                        final: settings.points_final,
                        champion: settings.points_champion
                    }
                };
                
                console.log('‚úÖ Favorite team settings loaded');
            } catch (error) {
                console.error('‚ùå Error loading favorite team settings:', error);
            }
        }

        // ============================================
        // UI UPDATES
        // ============================================
        
        function updateUIForLoggedInUser() {
            // Hide login button
            const loginBtn = document.getElementById('navLoginBtn');
            if (loginBtn) loginBtn.style.display = 'none';
            
            // Show user section
            const userSection = document.getElementById('navUserSection');
            const userBtn = document.getElementById('navUserBtn');
            
            if (userSection && userBtn) {
                userSection.style.display = 'flex';
                userBtn.textContent = currentPlayer.name;
            }
        }

        function updateUIForGuestUser() {
            // Show login button
            const loginBtn = document.getElementById('navLoginBtn');
            if (loginBtn) loginBtn.style.display = 'block';
            
            // Hide user section
            const userSection = document.getElementById('navUserSection');
            if (userSection) userSection.style.display = 'none';
        }

        async function handleLogout() {
            if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) return;
            
            await logoutUser();
            currentPlayer = null;
            groupId = null;
            matches = [];
            myPredictions = {};
            leaderboardData = [];
            
            updateUIForGuestUser();
            switchPage('homepage');
            renderAllPages();
            
            console.log('‚úÖ Logged out');
        }

        // Open Profile Page
        function openProfilePage() {
            switchPage('profile');
            renderProfilePage();
        }

        // Render Profile Page
        function renderProfilePage() {
            if (!currentPlayer) return;
            
            // Render stats
            const statsContainer = document.getElementById('profileStatsCards');
            const userStats = leaderboardData.find(p => p.id === currentPlayer.id);
            
            if (statsContainer && userStats) {
                statsContainer.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number">${userStats.rank}</div>
                        <div class="stat-label">üèÜ V·ªä TR√ç</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${userStats.points}</div>
                        <div class="stat-label">üìä ƒêI·ªÇM</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${userStats.exactScore}</div>
                        <div class="stat-label">üéØ T·ªà S·ªê</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${userStats.top1}</div>
                        <div class="stat-label">ü•á NH·∫§T</div>
                    </div>
                `;
            }
            
            // Render favorite team
            const favTeamContainer = document.getElementById('profileFavoriteTeam');
            if (favTeamContainer) {
                if (currentPlayer.favorite_team && countries[currentPlayer.favorite_team]) {
                    const teamData = countries[currentPlayer.favorite_team];
                    favTeamContainer.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 16px; padding: 16px; background: ${teamData.color}; border-radius: 12px;">
                            <div style="font-size: 48px;">${teamData.flag}</div>
                            <div style="flex: 1;">
                                <div style="font-size: 20px; font-weight: 600; color: var(--text);">${currentPlayer.favorite_team}</div>
                                <div style="font-size: 14px; color: var(--text-light); margin-top: 4px;">ƒê·ªôi y√™u th√≠ch c·ªßa b·∫°n</div>
                            </div>
                            <button class="btn btn-secondary" onclick="openFavoriteTeamModal()">ƒê·ªïi ƒë·ªôi</button>
                        </div>
                    `;
                } else {
                    favTeamContainer.innerHTML = `
                        <div style="text-align: center; padding: 32px; background: var(--bg-secondary); border-radius: 12px;">
                            <div style="font-size: 48px; margin-bottom: 16px;">‚≠ê</div>
                            <p style="color: var(--text-light); margin-bottom: 16px;">B·∫°n ch∆∞a ch·ªçn ƒë·ªôi y√™u th√≠ch</p>
                            <button class="btn btn-primary" onclick="openFavoriteTeamModal()">Ch·ªçn ngay</button>
                        </div>
                    `;
                }
            }
            
            // Render prediction history
            const historyContainer = document.getElementById('profilePredictionHistory');
            if (historyContainer) {
                const userMatches = matches.filter(m => m.userPrediction);
                if (userMatches.length > 0) {
                    historyContainer.innerHTML = userMatches.map(match => `
                        <div style="padding: 16px; background: var(--bg-secondary); border-radius: 12px; margin-bottom: 12px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <span style="font-weight: 600; color: var(--text);">${match.home} vs ${match.away}</span>
                                <span style="color: var(--text-light); font-size: 13px;">${match.date.toLocaleDateString('vi-VN')}</span>
                            </div>
                            <div style="display: flex; gap: 16px; align-items: center;">
                                <span style="font-size: 18px; font-weight: 600; color: var(--text);">${match.userPrediction.homeScore} - ${match.userPrediction.awayScore}</span>
                                <span style="color: var(--text-light);">${match.userPrediction.minute}'</span>
                                ${match.points ? `<span style="color: #10B981; margin-left: auto; font-weight: 600;">+${(match.points.rank || 0) + (match.points.exactScore || 0) + (match.points.minute || 0)} ƒëi·ªÉm</span>` : ''}
                            </div>
                        </div>
                    `).join('');
                } else {
                    historyContainer.innerHTML = '<p style="text-align: center; padding: 32px; color: var(--text-light);">B·∫°n ch∆∞a c√≥ d·ª± ƒëo√°n n√†o</p>';
                }
            }
        }

        function renderAllPages() {
            renderUpcomingMatches();
            renderScheduleMatches();
            renderHistoryMatches();
            renderLeaderboard();
            renderPersonalStats();
            renderStats();
        }

        // ============================================
        // RENDER FUNCTIONS
        // ============================================
        
        function renderMatchCard(match) {
            const card = document.createElement('div');
            card.className = 'match-card';
            
            if (match.status === 'not-open') {
                card.classList.add('disabled');
            }

            // Check if teams exist in countries database
            if (!countries[match.home]) {
                console.error(`Team "${match.home}" not found in countries database`);
                return card;
            }
            if (!countries[match.away]) {
                console.error(`Team "${match.away}" not found in countries database`);
                return card;
            }

            const homeData = countries[match.home];
            const awayData = countries[match.away];

            // Group badge
            card.innerHTML = `<div class="match-group-badge">${match.group}</div>`;

            // Teams
            const teams = document.createElement('div');
            teams.className = 'match-teams';
            teams.innerHTML = `
                <div class="team">
                    <div class="team-flag" style="background: ${homeData.color}">${homeData.flag}</div>
                    <div class="team-name">${match.home}</div>
                </div>
                <div class="match-vs">vs</div>
                <div class="team">
                    <div class="team-flag" style="background: ${awayData.color}">${awayData.flag}</div>
                    <div class="team-name">${match.away}</div>
                </div>
            `;
            card.appendChild(teams);

            // Datetime
            const datetime = document.createElement('div');
            datetime.className = 'match-datetime';
            datetime.innerHTML = `
                <span>üìÖ ${match.date.toLocaleDateString('vi-VN', { day: '2-digit', month: 'short' })}</span>
                <span>üïê ${match.date.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' })}</span>
            `;
            card.appendChild(datetime);

            // Status/Score/Result
            if (match.status === 'finished' && match.actualScore) {
                const score = document.createElement('div');
                score.className = 'match-score';
                score.innerHTML = `
                    <span class="score-number">${match.actualScore.homeScore}</span>
                    <span class="score-minute">${match.actualScore.minute}'</span>
                    <span class="score-number">${match.actualScore.awayScore}</span>
                `;
                card.appendChild(score);

                const result = document.createElement('div');
                result.className = 'match-result';
                if (match.userPrediction) {
                    const totalPoints = (match.points?.rank || 0) + (match.points?.exactScore || 0) + (match.points?.minute || 0);
                    result.innerHTML = `
                        <div class="prediction-text">‚úì ${match.userPrediction.homeScore}-${match.userPrediction.awayScore} | ${match.userPrediction.minute}'</div>
                        <div class="points-text">
                            ${match.points?.rank ? `<span class="point-badge">+${match.points.rank}</span>` : ''}
                            ${match.points?.exactScore ? `<span class="point-badge">+${match.points.exactScore}</span>` : ''}
                            ${match.points?.minute ? `<span class="point-badge">+${match.points.minute}</span>` : ''}
                        </div>
                    `;
                } else {
                    result.innerHTML = `
                        <div style="color: var(--text-light);">Kh√¥ng d·ª± ƒëo√°n</div>
                        <div class="points-text"><span class="point-badge">+0</span></div>
                    `;
                }
                card.appendChild(result);
            } else {
                const status = document.createElement('div');
                const now = new Date();
                const matchStarted = now > match.date;

                if (match.status === 'not-open') {
                    status.className = 'match-status not-open';
                    status.textContent = 'Ch∆∞a m·ªü d·ª± ƒëo√°n';
                } else if (match.status === 'open' && !match.userPrediction) {
                    status.className = 'match-status open';
                    status.innerHTML = '‚úì ƒê√£ m·ªü d·ª± ƒëo√°n';
                } else if (match.userPrediction && !matchStarted) {
                    status.className = 'match-status predicted';
                    status.innerHTML = `‚úì ${match.userPrediction.homeScore}-${match.userPrediction.awayScore} | ${match.userPrediction.minute}'`;
                } else if (match.userPrediction && matchStarted) {
                    status.className = 'match-status live';
                    status.innerHTML = `
                        <span>‚úì ${match.userPrediction.homeScore}-${match.userPrediction.awayScore} | ${match.userPrediction.minute}'</span>
                        <div class="live-progress"><div class="live-progress-bar"></div></div>
                    `;
                }
                card.appendChild(status);
            }

            // Click handler
            if (!currentPlayer) {
                card.onclick = () => {
                    alert('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ d·ª± ƒëo√°n!');
                    openLoginModal();
                };
            } else if (match.status === 'finished' && match.actualScore) {
                card.onclick = () => openResultsModal(match);
            } else if (match.status === 'open' || (match.userPrediction && match.status !== 'finished')) {
                card.onclick = () => openModal(match);
            }

            return card;
        }

        function renderFavoriteTeamCard() {
            if (!favoriteTeamSettings || !favoriteTeamSettings.isEnabled) return null;
            
            const card = document.createElement('div');
            const now = new Date();
            const isLocked = favoriteTeamSettings.isLocked || (favoriteTeamSettings.deadline && now > favoriteTeamSettings.deadline);
            
            card.className = isLocked ? 'favorite-team-card locked' : 'favorite-team-card';
            
            // Badge
            const badge = document.createElement('div');
            badge.className = 'favorite-team-badge';
            badge.textContent = isLocked ? 'üîí KH√ìA' : '‚≠ê M·ªöI';
            card.appendChild(badge);
            
            if (!favoriteTeamSettings.selectedTeam) {
                card.innerHTML += `
                    <div class="favorite-team-icon">‚≠ê</div>
                    <div class="favorite-team-title">Ch·ªçn ƒê·ªôi Y√™u Th√≠ch</div>
                    <div class="favorite-team-subtitle">
                        ${isLocked ? 'ƒê√£ h·∫øt h·∫°n ch·ªçn' : 'Nh·∫≠n ƒëi·ªÉm bonus theo th√†nh t√≠ch ƒë·ªôi!'}
                    </div>
                `;
                
                if (!isLocked && favoriteTeamSettings.deadline) {
                    card.innerHTML += `
                        <div class="favorite-team-deadline">
                            ‚è∞ H·∫°n: ${favoriteTeamSettings.deadline.toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit' })}
                        </div>
                    `;
                }
            } else {
                const teamData = countries[favoriteTeamSettings.selectedTeam];
                if (!teamData) {
                    console.error('Team not found:', favoriteTeamSettings.selectedTeam);
                    return null;
                }
                
                const selected = document.createElement('div');
                selected.className = 'favorite-team-selected';
                selected.innerHTML = `
                    <div class="favorite-team-selected-flag">${teamData.flag}</div>
                    <div class="favorite-team-selected-name">${favoriteTeamSettings.selectedTeam}</div>
                `;
                
                let pointsText = '';
                if (favoriteTeamSettings.teamStatus === 'eliminated') {
                    const points = getTeamPoints(favoriteTeamSettings.teamStatus);
                    pointsText = `ƒê√£ nh·∫≠n: ${points} ƒëi·ªÉm`;
                } else if (favoriteTeamSettings.teamStatus === 'champion') {
                    const points = favoriteTeamSettings.points.champion;
                    pointsText = `üèÜ V√¥ ƒë·ªãch: ${points} ƒëi·ªÉm!`;
                } else if (favoriteTeamSettings.teamStatus) {
                    const points = getTeamPoints(favoriteTeamSettings.teamStatus);
                    pointsText = `T·ªëi thi·ªÉu: ${points} ƒëi·ªÉm`;
                } else {
                    pointsText = `ƒêi·ªÉm max: ${favoriteTeamSettings.points.champion}`;
                }
                
                selected.innerHTML += `<div class="favorite-team-selected-points">${pointsText}</div>`;
                card.appendChild(selected);
            }
            
            if (!isLocked && currentPlayer) {
                card.onclick = () => openFavoriteTeamModal();
            } else if (!currentPlayer) {
                card.onclick = () => {
                    alert('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ch·ªçn ƒë·ªôi y√™u th√≠ch!');
                    openLoginModal();
                };
            }
            
            return card;
        }

        function getTeamPoints(status) {
            if (!favoriteTeamSettings) return 0;
            const pointsMap = {
                'round16': favoriteTeamSettings.points.round16,
                'quarter': favoriteTeamSettings.points.quarter,
                'semi': favoriteTeamSettings.points.semi,
                'final': favoriteTeamSettings.points.final,
                'champion': favoriteTeamSettings.points.champion
            };
            return pointsMap[status] || 0;
        }

        function renderUpcomingMatches() {
            const container = document.getElementById('upcomingMatches');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Add favorite team card first
            const favoriteCard = renderFavoriteTeamCard();
            if (favoriteCard) {
                container.appendChild(favoriteCard);
            }
            
            const upcoming = matches.filter(m => m.status !== 'finished').slice(0, 5);
            upcoming.forEach(match => {
                container.appendChild(renderMatchCard(match));
            });
        }

        function renderScheduleMatches() {
            const container = document.getElementById('scheduleMatches');
            if (!container) return;
            
            container.innerHTML = '';
            
            matches.forEach(match => {
                container.appendChild(renderMatchCard(match));
            });
        }

        function renderHistoryMatches() {
            const container = document.getElementById('historyMatches');
            if (!container) return;
            
            container.innerHTML = '';
            
            const history = matches.filter(m => m.status === 'finished').slice(0, 5);
            history.forEach(match => {
                container.appendChild(renderMatchCard(match));
            });
        }

        function renderLeaderboard() {
            const tbody = document.getElementById('leaderboardTable');
            const preview = document.getElementById('leaderboardPreview');
            
            let html = '';
            leaderboardData.forEach(player => {
                const rankClass = player.rank <= 4 ? `rank-${player.rank}` : 'rank-other';
                const isCurrentUser = currentPlayer && player.id === currentPlayer.id;
                const rowClass = isCurrentUser ? 'style="background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); border-left: 4px solid #F59E0B; font-weight: 600;"' : '';
                
                html += `
                    <tr ${rowClass}>
                        <td><span class="rank-badge ${rankClass}">${player.rank}</span></td>
                        <td><span class="player-name">${player.name}${isCurrentUser ? ' (B·∫°n)' : ''}</span></td>
                        <td><strong>${player.points}</strong></td>
                        <td>${player.top1}</td>
                        <td>${player.exactScore}</td>
                        <td>${player.exactMinute}</td>
                    </tr>
                `;
            });

            if (tbody) tbody.innerHTML = html || '<tr><td colspan="6" style="text-align: center; padding: 20px; color: #999;">Ch∆∞a c√≥ d·ªØ li·ªáu</td></tr>';
            if (preview) preview.innerHTML = html ? `<table class="leaderboard-table"><tbody>${html}</tbody></table>` : '<p style="text-align: center; padding: 20px; color: #999;">Ch∆∞a c√≥ d·ªØ li·ªáu</p>';
        }

        function renderPersonalStats() {
            const container = document.getElementById('personalStatsCards');
            if (!container) return;
            
            if (!currentPlayer) {
                container.innerHTML = '<p style="text-align: center; padding: 20px; color: #999;">ƒêƒÉng nh·∫≠p ƒë·ªÉ xem th√†nh t√≠ch</p>';
                return;
            }
            
            const userStats = leaderboardData.find(p => p.id === currentPlayer.id);
            
            if (!userStats) {
                container.innerHTML = '<p style="text-align: center; padding: 20px; color: #999;">Ch∆∞a c√≥ d·ªØ li·ªáu</p>';
                return;
            }
            
            container.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${userStats.rank}</div>
                    <div class="stat-label">üèÜ V·ªä TR√ç</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${userStats.points}</div>
                    <div class="stat-label">üìä ƒêI·ªÇM</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${userStats.exactScore}</div>
                    <div class="stat-label">üéØ T·ªà S·ªê</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${userStats.top1}</div>
                    <div class="stat-label">ü•á NH·∫§T</div>
                </div>
            `;
        }

        function renderStats() {
            const container = document.getElementById('statsFavoriteTeam');
            if (!container) return;
            
            if (!currentPlayer || !favoriteTeamSettings || !favoriteTeamSettings.selectedTeam) {
                container.innerHTML = '';
                return;
            }
            
            const teamData = countries[favoriteTeamSettings.selectedTeam];
            if (!teamData) return;
            
            const status = favoriteTeamSettings.teamStatus;
            
            let statusText = '';
            let pointsLabel = '';
            let pointsValue = 0;
            
            if (status === 'champion') {
                statusText = 'üèÜ V√¥ ƒë·ªãch!';
                pointsLabel = 'ƒêi·ªÉm nh·∫≠n ƒë∆∞·ª£c';
                pointsValue = favoriteTeamSettings.points.champion;
            } else if (status === 'eliminated' || status === 'round16' || status === 'quarter' || status === 'semi' || status === 'final') {
                const points = getTeamPoints(status === 'eliminated' ? 'round16' : status);
                statusText = status === 'eliminated' ? '‚ùå ƒê√£ b·ªã lo·∫°i' : `‚úì ƒê√£ ƒë·∫°t ${getStatusName(status)}`;
                pointsLabel = 'ƒêi·ªÉm nh·∫≠n ƒë∆∞·ª£c';
                pointsValue = points;
            } else {
                statusText = '‚öΩ ƒêang thi ƒë·∫•u';
                pointsLabel = 'ƒêi·ªÉm t·ªëi thi·ªÉu';
                pointsValue = favoriteTeamSettings.points.round16;
            }
            
            container.innerHTML = `
                <div class="stats-favorite-team">
                    <div class="stats-favorite-team-header">
                        <div class="stats-favorite-team-icon">${teamData.flag}</div>
                        <div class="stats-favorite-team-info">
                            <div class="stats-favorite-team-name">${favoriteTeamSettings.selectedTeam}</div>
                            <div class="stats-favorite-team-status">${statusText}</div>
                        </div>
                    </div>
                    <div class="stats-favorite-team-points">
                        <div class="stats-favorite-team-points-label">${pointsLabel}</div>
                        <div class="stats-favorite-team-points-value">+${pointsValue}</div>
                    </div>
                </div>
            `;
        }

        function getStatusName(status) {
            const names = {
                'round16': 'V√≤ng 16',
                'quarter': 'T·ª© k·∫øt',
                'semi': 'B√°n k·∫øt',
                'final': 'Chung k·∫øt'
            };
            return names[status] || status;
        }

        // ============================================
        // MODAL FUNCTIONS
        // ============================================
        
        function openModal(match) {
            if (!currentPlayer) {
                alert('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ d·ª± ƒëo√°n!');
                openLoginModal();
                return;
            }
            
            // Security: Check if match already started
            const now = new Date();
            const matchDate = new Date(match.date);
            
            if (matchDate <= now && match.status !== 'finished') {
                alert('‚è∞ Tr·∫≠n ƒë·∫•u ƒë√£ b·∫Øt ƒë·∫ßu! Kh√¥ng th·ªÉ d·ª± ƒëo√°n n·ªØa.');
                return;
            }
            
            // If match finished, show results instead
            if (match.status === 'finished') {
                openResultsModal(match);
                return;
            }
            
            selectedMatch = match;
            isEditMode = !match.userPrediction;

            const modal = document.getElementById('predictionModal');
            const homeFlag = document.getElementById('modalHomeFlag');
            const awayFlag = document.getElementById('modalAwayFlag');
            const homeName = document.getElementById('modalHomeName');
            const awayName = document.getElementById('modalAwayName');

            if (!countries[match.home] || !countries[match.away]) {
                console.error(`Team not found in countries database: ${match.home} or ${match.away}`);
                alert('L·ªói: Kh√¥ng t√¨m th·∫•y th√¥ng tin ƒë·ªôi b√≥ng. Vui l√≤ng li√™n h·ªá admin.');
                return;
            }

            homeFlag.innerHTML = countries[match.home].flag;
            homeFlag.style.background = countries[match.home].color;
            awayFlag.innerHTML = countries[match.away].flag;
            awayFlag.style.background = countries[match.away].color;
            homeName.textContent = match.home;
            awayName.textContent = match.away;

            const inputHome = document.getElementById('inputHomeScore');
            const inputAway = document.getElementById('inputAwayScore');
            const inputMinute = document.getElementById('inputMinute');
            const btnConfirm = document.getElementById('btnConfirm');
            const btnEdit = document.getElementById('btnEdit');
            const checkmark = document.getElementById('successCheckmark');
            const warning = document.getElementById('validationWarning');

            checkmark.classList.remove('show');
            warning.classList.remove('show');

            if (match.userPrediction) {
                inputHome.value = match.userPrediction.homeScore;
                inputAway.value = match.userPrediction.awayScore;
                inputMinute.value = match.userPrediction.minute;
                
                inputHome.disabled = true;
                inputAway.disabled = true;
                inputMinute.disabled = true;
                
                btnConfirm.style.display = 'none';
                btnEdit.style.display = 'block';
            } else {
                inputHome.value = 2;
                inputAway.value = 0;
                inputMinute.value = 45;
                
                inputHome.disabled = false;
                inputAway.disabled = false;
                inputMinute.disabled = false;
                
                btnConfirm.style.display = 'block';
                btnEdit.style.display = 'none';
            }

            modal.classList.add('active');
        }

        function closeModal() {
            document.getElementById('predictionModal').classList.remove('active');
        }

        function editPrediction() {
            const inputHome = document.getElementById('inputHomeScore');
            const inputAway = document.getElementById('inputAwayScore');
            const inputMinute = document.getElementById('inputMinute');
            const btnConfirm = document.getElementById('btnConfirm');
            const btnEdit = document.getElementById('btnEdit');

            inputHome.disabled = false;
            inputAway.disabled = false;
            inputMinute.disabled = false;
            
            btnConfirm.style.display = 'block';
            btnEdit.style.display = 'none';
            
            isEditMode = true;
        }

        async function confirmPrediction() {
            const homeScore = parseInt(document.getElementById('inputHomeScore').value);
            const awayScore = parseInt(document.getElementById('inputAwayScore').value);
            const minute = parseInt(document.getElementById('inputMinute').value);
            
            if (homeScore === 0 && awayScore === 0 && minute !== 0) {
                showValidationWarning();
                return;
            }
            
            console.log('üíæ Saving prediction...', { homeScore, awayScore, minute });
            
            try {
                const result = await savePrediction(
                    selectedMatch.id,
                    currentPlayer.id,
                    homeScore,
                    awayScore,
                    minute
                );
                
                if (result.success) {
                    console.log('‚úÖ Prediction saved!');
                    
                    // Update local data
                    selectedMatch.userPrediction = { homeScore, awayScore, minute };
                    myPredictions[selectedMatch.id] = result.prediction;
                    
                    // Show success animation
                    document.getElementById('inputHomeScore').disabled = true;
                    document.getElementById('inputAwayScore').disabled = true;
                    document.getElementById('inputMinute').disabled = true;
                    document.getElementById('btnConfirm').style.display = 'none';
                    document.getElementById('btnEdit').style.display = 'block';
                    document.getElementById('successCheckmark').classList.add('show');
                    
                    setTimeout(() => {
                        closeModal();
                        renderAllPages();
                    }, 1500);
                } else {
                    console.error('‚ùå Failed to save prediction:', result.error);
                    alert('L·ªói khi l∆∞u d·ª± ƒëo√°n: ' + result.error);
                }
            } catch (error) {
                console.error('‚ùå Error saving prediction:', error);
                alert('L·ªói khi l∆∞u d·ª± ƒëo√°n: ' + error.message);
            }
        }

        function showValidationWarning() {
            const warning = document.getElementById('validationWarning');
            warning.classList.add('show');
            setTimeout(() => warning.classList.remove('show'), 3000);
        }

        function openResultsModal(match) {
            const modal = document.getElementById('resultsModal');
            
            if (!countries[match.home] || !countries[match.away]) {
                console.error(`Team not found in countries database: ${match.home} or ${match.away}`);
                alert('L·ªói: Kh√¥ng t√¨m th·∫•y th√¥ng tin ƒë·ªôi b√≥ng. Vui l√≤ng li√™n h·ªá admin.');
                return;
            }
            
            document.getElementById('resultsHomeFlag').innerHTML = countries[match.home].flag;
            document.getElementById('resultsHomeFlag').style.background = countries[match.home].color;
            document.getElementById('resultsAwayFlag').innerHTML = countries[match.away].flag;
            document.getElementById('resultsAwayFlag').style.background = countries[match.away].color;
            document.getElementById('resultsHomeName').textContent = match.home;
            document.getElementById('resultsAwayName').textContent = match.away;
            
            document.getElementById('resultsHomeScore').textContent = match.actualScore.homeScore;
            document.getElementById('resultsAwayScore').textContent = match.actualScore.awayScore;
            document.getElementById('resultsMinute').textContent = `${match.actualScore.minute}'`;
            
            // Load all predictions for this match from all players in group
            const resultsList = document.getElementById('resultsList');
            resultsList.innerHTML = '<p style="text-align: center; padding: 20px; color: #999;">ƒêang t·∫£i d·ª± ƒëo√°n...</p>';
            
            getMatchPredictions(match.id).then(predictions => {
                resultsList.innerHTML = '';
                
                if (predictions.length === 0) {
                    resultsList.innerHTML = '<p style="text-align: center; padding: 20px; color: #999;">Ch∆∞a c√≥ ai d·ª± ƒëo√°n tr·∫≠n n√†y</p>';
                    return;
                }
                
                // Sort by total points descending
                predictions.sort((a, b) => (b.total_points || 0) - (a.total_points || 0));
                
                // Create table structure (compact design like image 2)
                let tableHTML = `
                    <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                        <tbody>
                `;
                
                predictions.forEach((pred, index) => {
                    const isCurrentUser = currentPlayer && pred.player_id === currentPlayer.id;
                    const bgColor = isCurrentUser ? '#FEF3C7' : (index % 2 === 0 ? '#F9FAFB' : 'white');
                    
                    const totalPoints = pred.total_points || 0;
                    const pointsRank = pred.points_rank || 0;
                    const pointsExact = pred.points_exact_score || 0;
                    const pointsMinute = pred.points_minute || 0;
                    
                    const rankBadge = index === 0 ? 'ü•á' : (index === 1 ? 'ü•à' : (index === 2 ? 'ü•â' : `${index + 1}`));
                    
                    tableHTML += `
                        <tr style="background: ${bgColor}; border-bottom: 1px solid #E5E7EB;">
                            <td style="padding: 12px 8px; text-align: center; font-size: 16px; width: 40px; font-weight: 600;">
                                ${rankBadge}
                            </td>
                            <td style="padding: 12px 12px; font-weight: ${isCurrentUser ? '600' : '500'}; color: ${isCurrentUser ? '#92400E' : '#1F2937'};">
                                ${pred.player_name}${isCurrentUser ? ' (B·∫°n)' : ''}
                            </td>
                            <td style="padding: 12px 8px; text-align: center; font-weight: 600; width: 80px; color: #1F2937; font-size: 16px;">
                                ${pred.home_score}-${pred.away_score}
                            </td>
                            <td style="padding: 12px 8px; text-align: center; color: #6B7280; width: 60px; font-size: 14px;">
                                ${pred.minute}'
                            </td>
                            <td style="padding: 12px 8px; text-align: center; width: 140px;">
                                ${pointsRank ? `<span style="display: inline-block; background: #DBEAFE; color: #1E40AF; padding: 3px 8px; border-radius: 4px; font-size: 12px; margin: 0 2px; font-weight: 600;">üèÜ +${pointsRank}</span>` : ''}
                                ${pointsExact ? `<span style="display: inline-block; background: #D1FAE5; color: #065F46; padding: 3px 8px; border-radius: 4px; font-size: 12px; margin: 0 2px; font-weight: 600;">üéØ +${pointsExact}</span>` : ''}
                                ${pointsMinute ? `<span style="display: inline-block; background: #FEF3C7; color: #92400E; padding: 3px 8px; border-radius: 4px; font-size: 12px; margin: 0 2px; font-weight: 600;">üí° +${pointsMinute}</span>` : ''}
                            </td>
                            <td style="padding: 12px 12px; text-align: center; font-weight: 700; color: #10B981; width: 70px; font-size: 16px;">
                                +${totalPoints}
                            </td>
                        </tr>
                    `;
                });
                
                tableHTML += `
                        </tbody>
                    </table>
                `;
                
                resultsList.innerHTML = tableHTML;
            }).catch(error => {
                console.error('Error loading predictions:', error);
                resultsList.innerHTML = '<p style="text-align: center; padding: 20px; color: #f87171;">L·ªói t·∫£i d·ªØ li·ªáu</p>';
            });

            modal.classList.add('active');
        }

        function closeResultsModal() {
            document.getElementById('resultsModal').classList.remove('active');
        }

        // ============================================
        // LOGIN MODAL
        // ============================================
        
        function openLoginModal() {
            document.getElementById('loginModal').classList.add('active');
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
        }

        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginName').value.trim();
            const password = document.getElementById('loginPassword').value;
            const groupCode = document.getElementById('loginGroupCode').value.trim();
            
            console.log('üîê Attempting login...', { email, groupCode });
            
            try {
                // Verify group code
                if (groupCode !== DEMO_GROUP_CODE) {
                    alert('M√£ nh√≥m kh√¥ng ƒë√∫ng!');
                    return;
                }
                
                // Login
                const result = await loginUser(email, password);
                
                if (result.success) {
                    console.log('‚úÖ Login successful!');
                    currentPlayer = result.player;
                    
                    closeLoginModal();
                    
                    // Reload app with user data
                    await initApp();
                    
                    alert('ƒêƒÉng nh·∫≠p th√†nh c√¥ng!');
                } else {
                    console.error('‚ùå Login failed:', result.error);
                    alert('ƒêƒÉng nh·∫≠p th·∫•t b·∫°i: ' + result.error);
                }
            } catch (error) {
                console.error('‚ùå Login error:', error);
                alert('L·ªói ƒëƒÉng nh·∫≠p: ' + error.message);
            }
        }

        // ============================================
        // FAVORITE TEAM MODAL
        // ============================================
        
        let tempSelectedTeam = null;

        function openFavoriteTeamModal() {
            if (!currentPlayer) {
                alert('Vui l√≤ng ƒëƒÉng nh·∫≠p!');
                openLoginModal();
                return;
            }
            
            const modal = document.getElementById('favoriteTeamModal');
            const deadlineText = document.getElementById('favoriteDeadlineText');
            const searchInput = document.getElementById('favoriteTeamSearch');
            
            if (favoriteTeamSettings.deadline) {
                deadlineText.textContent = favoriteTeamSettings.deadline.toLocaleString('vi-VN', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
            
            searchInput.value = '';
            tempSelectedTeam = favoriteTeamSettings.selectedTeam;
            
            renderFavoriteTeamList();
            
            if (tempSelectedTeam) {
                updateFavoriteTeamSelected(tempSelectedTeam);
            }
            
            modal.classList.add('active');
        }

        function closeFavoriteTeamModal() {
            document.getElementById('favoriteTeamModal').classList.remove('active');
            document.getElementById('favoriteSuccessCheckmark').classList.remove('show');
            document.getElementById('favoriteTeamActions').style.display = 'flex';
            document.getElementById('favoriteTeamList').style.display = 'block';
            document.getElementById('favoriteTeamSearch').parentElement.style.display = 'block';
            tempSelectedTeam = null;
        }

        function renderFavoriteTeamList(filter = '') {
            const listContainer = document.getElementById('favoriteTeamList');
            listContainer.innerHTML = '';
            
            const teamNames = Object.keys(countries).filter(name => 
                filter === '' || name.toLowerCase().includes(filter.toLowerCase())
            );
            
            teamNames.forEach(teamName => {
                const teamData = countries[teamName];
                const item = document.createElement('div');
                item.style.cssText = `
                    display: flex;
                    align-items: center;
                    gap: 12px;
                    padding: 12px;
                    cursor: pointer;
                    border-radius: 8px;
                    transition: background 0.2s;
                    border: 2px solid transparent;
                `;
                
                if (tempSelectedTeam === teamName) {
                    item.style.background = 'var(--yellow-bg)';
                    item.style.borderColor = '#F59E0B';
                }
                
                item.innerHTML = `
                    <div style="font-size: 32px;">${teamData.flag}</div>
                    <div style="flex: 1;">
                        <div style="font-size: 14px; font-weight: 600; color: var(--text-dark);">${teamName}</div>
                        <div style="font-size: 12px; color: var(--text-light);">ƒêi·ªÉm max: ${favoriteTeamSettings.points.champion}</div>
                    </div>
                `;
                
                item.onclick = () => selectTeam(teamName);
                
                item.onmouseenter = () => {
                    if (tempSelectedTeam !== teamName) {
                        item.style.background = 'var(--bg-gray)';
                    }
                };
                
                item.onmouseleave = () => {
                    if (tempSelectedTeam !== teamName) {
                        item.style.background = 'transparent';
                    }
                };
                
                listContainer.appendChild(item);
            });
        }

        function selectTeam(teamName) {
            tempSelectedTeam = teamName;
            renderFavoriteTeamList(document.getElementById('favoriteTeamSearch').value);
            updateFavoriteTeamSelected(teamName);
            document.getElementById('btnConfirmFavorite').disabled = false;
        }

        function updateFavoriteTeamSelected(teamName) {
            const selectedDiv = document.getElementById('favoriteTeamSelected');
            const teamData = countries[teamName];
            
            document.getElementById('selectedTeamFlag').textContent = teamData.flag;
            document.getElementById('selectedTeamName').textContent = teamName;
            document.getElementById('selectedTeamPoints').textContent = `ƒêi·ªÉm n·∫øu v√¥ ƒë·ªãch: ${favoriteTeamSettings.points.champion} ƒëi·ªÉm`;
            
            selectedDiv.style.display = 'block';
        }

        async function confirmFavoriteTeam() {
            if (!tempSelectedTeam) return;
            
            console.log('üíæ Saving favorite team...', tempSelectedTeam);
            
            try {
                const result = await selectFavoriteTeam(currentPlayer.id, tempSelectedTeam);
                
                if (result.success) {
                    console.log('‚úÖ Favorite team saved!');
                    
                    favoriteTeamSettings.selectedTeam = tempSelectedTeam;
                    favoriteTeamSettings.teamStatus = 'active';
                    currentPlayer.favorite_team = tempSelectedTeam;
                    currentPlayer.favorite_team_status = 'active';
                    
                    document.getElementById('favoriteTeamList').style.display = 'none';
                    document.getElementById('favoriteTeamSearch').parentElement.style.display = 'none';
                    document.getElementById('favoriteTeamActions').style.display = 'none';
                    document.getElementById('favoriteTeamSelected').style.display = 'none';
                    
                    const checkmark = document.getElementById('favoriteSuccessCheckmark');
                    checkmark.classList.add('show');
                    
                    setTimeout(() => {
                        closeFavoriteTeamModal();
                        renderAllPages();
                    }, 1500);
                } else {
                    console.error('‚ùå Failed to save favorite team:', result.error);
                    alert('L·ªói khi l∆∞u ƒë·ªôi y√™u th√≠ch: ' + result.error);
                }
            } catch (error) {
                console.error('‚ùå Error saving favorite team:', error);
                alert('L·ªói: ' + error.message);
            }
        }

        // Search handler for favorite team
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('favoriteTeamSearch');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    renderFavoriteTeamList(this.value);
                });
            }
        });

        // ============================================
        // PAGE NAVIGATION
        // ============================================
        
        function switchPage(pageId) {
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => {
                if (tab.onclick && tab.onclick.toString().includes(pageId)) {
                    tab.classList.add('active');
                }
            });
        }

        // ============================================
        // INITIALIZE APP - SIMPLE & DIRECT
        // ============================================
        
        // All code is inline - no external scripts to wait for!
        // Just start when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOM ready, starting app...');
            initApp();
        });

        console.log('‚úÖ Script loaded - ready to initialize');
    </script>
</body>
</html>
